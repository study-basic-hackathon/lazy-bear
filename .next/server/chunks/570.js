"use strict";exports.id=570,exports.ids=[570],exports.modules={6766:(a,b,c)=>{c.d(b,{p:()=>f});var d=c(46493),e=c(59048);class f extends e.pe{static [d.i]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}},7284:(a,b,c)=>{c.d(b,{HE:()=>k,Io:()=>o,Lf:()=>p,XI:()=>n,e:()=>g});var d=c(46493),e=c(35071);let f=Symbol.for("drizzle:Schema"),g=Symbol.for("drizzle:Columns"),h=Symbol.for("drizzle:ExtraConfigColumns"),i=Symbol.for("drizzle:OriginalName"),j=Symbol.for("drizzle:BaseName"),k=Symbol.for("drizzle:IsAlias"),l=Symbol.for("drizzle:ExtraConfigBuilder"),m=Symbol.for("drizzle:IsDrizzleTable");class n{static [d.i]="Table";static Symbol={Name:e.E,Schema:f,OriginalName:i,Columns:g,ExtraConfigColumns:h,BaseName:j,IsAlias:k,ExtraConfigBuilder:l};[e.E];[i];[f];[g];[h];[j];[k]=!1;[m]=!0;[l]=void 0;constructor(a,b,c){this[e.E]=this[i]=a,this[f]=b,this[j]=c}}function o(a){return a[e.E]}function p(a){return`${a[f]??"public"}.${a[e.E]}`}},14880:(a,b,c)=>{c.d(b,{Pq:()=>h,iX:()=>g});var d=c(46493),e=c(59048);class f extends e.pe{static [d.i]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new g(a,this.config)}}class g extends e.Kl{static [d.i]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function h(a){return new f(a??"")}},19593:(a,b,c)=>{c.d(b,{n:()=>d});let d=Symbol.for("drizzle:ViewBaseConfig")},19831:(a,b,c)=>{c.d(b,{Xd:()=>i,kB:()=>j});var d=c(46493),e=c(41313),f=c(59048),g=c(91983);class h extends g.u{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [d.i]="PgTimeBuilder";build(a){return new i(a,this.config)}}class i extends f.Kl{static [d.i]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}function j(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return new h(c,d.withTimezone??!1,d.precision)}},22297:(a,b,c)=>{c.d(b,{mu:()=>aS,cJ:()=>aT});var d=c(46493),e=c(7284),f=c(41313),g=c(59048),h=c(6766);class i extends h.p{static [d.i]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new j(a,this.config)}}class j extends g.Kl{static [d.i]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class k extends h.p{static [d.i]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new l(a,this.config)}}class l extends g.Kl{static [d.i]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}function m(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return"number"===d.mode?new i(c):new k(c)}class n extends g.pe{static [d.i]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new o(a,this.config)}}class o extends g.Kl{static [d.i]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class p extends g.pe{static [d.i]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new q(a,this.config)}}class q extends g.Kl{static [d.i]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}function r(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return"number"===d.mode?new n(c):new p(c)}class s extends g.pe{static [d.i]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new t(a,this.config)}}class t extends g.Kl{static [d.i]="PgBoolean";getSQLType(){return"boolean"}}function u(a){return new s(a??"")}class v extends g.pe{static [d.i]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new w(a,this.config)}}class w extends g.Kl{static [d.i]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function x(a,b={}){let{name:c,config:d}=(0,f.Ll)(a,b);return new v(c,d)}class y extends g.pe{static [d.i]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new z(a,this.config)}}class z extends g.Kl{static [d.i]="PgCidr";getSQLType(){return"cidr"}}function A(a){return new y(a??"")}class B extends g.pe{static [d.i]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new C(a,this.config)}}class C extends g.Kl{static [d.i]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function D(a){return(b,c)=>{let{name:d,config:e}=(0,f.Ll)(b,c);return new B(d,e,a)}}var E=c(46886);class F extends g.pe{static [d.i]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new G(a,this.config)}}class G extends g.Kl{static [d.i]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}function H(a){return new F(a??"")}class I extends g.pe{static [d.i]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new J(a,this.config)}}class J extends g.Kl{static [d.i]="PgInet";getSQLType(){return"inet"}}function K(a){return new I(a??"")}var L=c(84266);class M extends g.pe{static [d.i]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new N(a,this.config)}}class N extends g.Kl{static [d.i]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}function O(a,b={}){let{name:c,config:d}=(0,f.Ll)(a,b);return new M(c,d)}var P=c(14880),Q=c(94728);class R extends g.pe{static [d.i]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new S(a,this.config)}}class S extends g.Kl{static [d.i]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class T extends g.pe{static [d.i]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new U(a,this.config)}}class U extends g.Kl{static [d.i]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}function V(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode&&"tuple"!==d.mode?new T(c):new R(c)}class W extends g.pe{static [d.i]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new X(a,this.config)}}class X extends g.Kl{static [d.i]="PgMacaddr";getSQLType(){return"macaddr"}}function Y(a){return new W(a??"")}class Z extends g.pe{static [d.i]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new $(a,this.config)}}class $ extends g.Kl{static [d.i]="PgMacaddr8";getSQLType(){return"macaddr8"}}function _(a){return new Z(a??"")}var aa=c(66587);class ab extends g.pe{static [d.i]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new ac(a,this.config)}}class ac extends g.Kl{static [d.i]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class ad extends g.pe{static [d.i]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new ae(a,this.config)}}class ae extends g.Kl{static [d.i]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function af(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode&&"tuple"!==d.mode?new ad(c):new ab(c)}function ag(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function ah(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=ag(b,c),d=ag(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class ai extends g.pe{static [d.i]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new aj(a,this.config)}}class aj extends g.Kl{static [d.i]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return ah(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class ak extends g.pe{static [d.i]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new al(a,this.config)}}class al extends g.Kl{static [d.i]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=ah(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}function am(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode&&"tuple"!==d.mode?new ak(c):new ai(c)}class an extends g.pe{static [d.i]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new ao(a,this.config)}}class ao extends g.Kl{static [d.i]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}function ap(a){return new an(a??"")}class aq extends g.pe{static [d.i]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new ar(a,this.config)}}class ar extends g.Kl{static [d.i]="PgSerial";getSQLType(){return"serial"}}function as(a){return new aq(a??"")}class at extends h.p{static [d.i]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new au(a,this.config)}}class au extends g.Kl{static [d.i]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}function av(a){return new at(a??"")}class aw extends g.pe{static [d.i]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new ax(a,this.config)}}class ax extends g.Kl{static [d.i]="PgSmallSerial";getSQLType(){return"smallserial"}}function ay(a){return new aw(a??"")}var az=c(29745),aA=c(19831),aB=c(62352),aC=c(29205),aD=c(57789);class aE extends g.pe{static [d.i]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new aF(a,this.config)}}class aF extends g.Kl{static [d.i]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function aG(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aE(c,d)}class aH extends g.pe{static [d.i]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new aI(a,this.config)}}class aI extends g.Kl{static [d.i]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function aJ(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aH(c,d)}class aK extends g.pe{static [d.i]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new aL(a,this.config)}}class aL extends g.Kl{static [d.i]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function aM(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aK(c,d)}class aN extends g.pe{static [d.i]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new aO(a,this.config)}}class aO extends g.Kl{static [d.i]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function aP(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aN(c,d)}let aQ=Symbol.for("drizzle:PgInlineForeignKeys"),aR=Symbol.for("drizzle:EnableRLS");class aS extends e.XI{static [d.i]="PgTable";static Symbol=Object.assign({},e.XI.Symbol,{InlineForeignKeys:aQ,EnableRLS:aR});[aQ]=[];[aR]=!1;[e.XI.Symbol.ExtraConfigBuilder]=void 0}let aT=(a,b,c)=>(function(a,b,c,d,f=a){let g=new aS(a,d,f),h="function"==typeof b?b({bigint:m,bigserial:r,boolean:u,char:x,cidr:A,customType:D,date:E.p6,doublePrecision:H,inet:K,integer:L.nd,interval:O,json:P.Pq,jsonb:Q.Fx,line:V,macaddr:Y,macaddr8:_,numeric:aa.sH,point:af,geometry:am,real:ap,serial:as,smallint:av,smallserial:ay,text:az.Qq,time:aA.kB,timestamp:aB.vE,uuid:aC.uR,varchar:aD.yf,bit:aG,halfvec:aJ,sparsevec:aM,vector:aP}):b,i=Object.fromEntries(Object.entries(h).map(([a,b])=>{b.setName(a);let c=b.build(g);return g[aQ].push(...b.buildForeignKeys(c,g)),[a,c]})),j=Object.fromEntries(Object.entries(h).map(([a,b])=>(b.setName(a),[a,b.buildExtraConfigColumn(g)]))),k=Object.assign(g,i);return k[e.XI.Symbol.Columns]=i,k[e.XI.Symbol.ExtraConfigColumns]=j,c&&(k[aS.Symbol.ExtraConfigBuilder]=c),Object.assign(k,{enableRLS:()=>(k[aS.Symbol.EnableRLS]=!0,k)})})(a,b,c,void 0)},27017:(a,b,c)=>{let d,e;c.d(b,{k:()=>g});var f=c(47878);let g={startActiveSpan:(a,b)=>d?(e||(e=d.trace.getTracer("drizzle-orm","0.36.4")),(0,f.i)((c,d)=>d.startActiveSpan(a,a=>{try{return b(a)}catch(b){throw a.setStatus({code:c.SpanStatusCode.ERROR,message:b instanceof Error?b.message:"Unknown error"}),b}finally{a.end()}}),d,e)):b()}},29205:(a,b,c)=>{c.d(b,{dL:()=>h,uR:()=>i});var d=c(46493),e=c(50047),f=c(59048);class g extends f.pe{static [d.i]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default((0,e.ll)`gen_random_uuid()`)}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgUUID";getSQLType(){return"uuid"}}function i(a){return new g(a??"")}},29745:(a,b,c)=>{c.d(b,{Qq:()=>i});var d=c(46493),e=c(41313),f=c(59048);class g extends f.pe{static [d.i]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function i(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return new g(c,d)}},35071:(a,b,c)=>{c.d(b,{E:()=>d});let d=Symbol.for("drizzle:Name")},41313:(a,b,c)=>{c.d(b,{DV:()=>k,He:()=>function a(b,c){return Object.entries(b).reduce((b,[g,i])=>{if("string"!=typeof g)return b;let j=c?[...c,g]:[g];return(0,e.is)(i,d.V)||(0,e.is)(i,f.Xs)||(0,e.is)(i,f.Xs.Aliased)?b.push({path:j,field:i}):(0,e.is)(i,h.XI)?b.push(...a(i[h.XI.Symbol.Columns],j)):b.push(...a(i,j)),b},[])},Ll:()=>p,Lq:()=>q,XJ:()=>m,YD:()=>n,a6:()=>j,q:()=>l,zN:()=>o});var d=c(80228),e=c(46493),f=c(50047),g=c(96176),h=c(7284),i=c(19593);function j(a,b,c){let g={},i=a.reduce((a,{path:i,field:j},k)=>{let l;l=(0,e.is)(j,d.V)?j:(0,e.is)(j,f.Xs)?j.decoder:j.sql.decoder;let m=a;for(let[a,f]of i.entries())if(a<i.length-1)f in m||(m[f]={}),m=m[f];else{let a=b[k],n=m[f]=null===a?null:l.mapFromDriverValue(a);if(c&&(0,e.is)(j,d.V)&&2===i.length){let a=i[0];a in g?"string"==typeof g[a]&&g[a]!==(0,h.Io)(j.table)&&(g[a]=!1):g[a]=null===n&&(0,h.Io)(j.table)}}return a},{});if(c&&Object.keys(g).length>0)for(let[a,b]of Object.entries(g))"string"!=typeof b||c[b]||(i[a]=null);return i}function k(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function l(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>(0,e.is)(c,f.Xs)||(0,e.is)(c,d.V)?[b,c]:[b,new f.Iw(c,a[h.XI.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function m(a,b){for(let c of b)for(let b of Object.getOwnPropertyNames(c.prototype))"constructor"!==b&&Object.defineProperty(a.prototype,b,Object.getOwnPropertyDescriptor(c.prototype,b)||Object.create(null))}function n(a){return a[h.XI.Symbol.Columns]}function o(a){return(0,e.is)(a,g.n)?a._.alias:(0,e.is)(a,f.Ss)?a[i.n].name:(0,e.is)(a,f.Xs)?void 0:a[h.XI.Symbol.IsAlias]?a[h.XI.Symbol.Name]:a[h.XI.Symbol.BaseName]}function p(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}function q(a){if("object"!=typeof a||null===a||"Object"!==a.constructor.name)return!1;if("logger"in a){let b=typeof a.logger;return"boolean"===b||"object"===b&&"function"==typeof a.logger.logQuery||"undefined"===b}if("schema"in a){let b=typeof a.logger;return"object"===b||"undefined"===b}if("casing"in a){let b=typeof a.logger;return"string"===b||"undefined"===b}if("mode"in a)return"default"===a.mode&&"planetscale"===a.mode&&void 0===a.mode;if("connection"in a){let b=typeof a.connection;return"string"===b||"object"===b||"undefined"===b}if("client"in a){let b=typeof a.client;return"object"===b||"function"===b||"undefined"===b}return 0===Object.keys(a).length}},46493:(a,b,c)=>{c.d(b,{i:()=>d,is:()=>e});let d=Symbol.for("drizzle:entityKind");function e(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,d))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(d in c&&c[d]===b[d])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind")},46886:(a,b,c)=>{c.d(b,{dw:()=>k,p6:()=>l,qw:()=>i});var d=c(46493),e=c(41313),f=c(59048),g=c(91983);class h extends g.u{static [d.i]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new i(a,this.config)}}class i extends f.Kl{static [d.i]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return new Date(a)}mapToDriverValue(a){return a.toISOString()}}class j extends g.u{static [d.i]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new k(a,this.config)}}class k extends f.Kl{static [d.i]="PgDateString";getSQLType(){return"date"}}function l(a,b){let{name:c,config:d}=(0,e.Ll)(a,b);return d?.mode==="date"?new h(c):new j(c)}},47878:(a,b,c)=>{c.d(b,{i:()=>d});function d(a,...b){return a(...b)}},48689:(a,b,c)=>{c.d(b,{AU:()=>m,B3:()=>B,KJ:()=>w,KL:()=>s,Pe:()=>u,RK:()=>A,RO:()=>o,RV:()=>r,Tq:()=>x,Uo:()=>k,eq:()=>i,gt:()=>n,kZ:()=>t,lt:()=>p,mj:()=>z,ne:()=>j,o8:()=>y,or:()=>l,q1:()=>C,t2:()=>v,wJ:()=>q});var d=c(80228),e=c(46493),f=c(7284),g=c(50047);function h(a,b){return!(0,g.eG)(b)||(0,g.qt)(a)||(0,e.is)(a,g.Iw)||(0,e.is)(a,g.Or)||(0,e.is)(a,d.V)||(0,e.is)(a,f.XI)||(0,e.is)(a,g.Ss)?a:new g.Iw(a,b)}let i=(a,b)=>(0,g.ll)`${a} = ${h(b,a)}`,j=(a,b)=>(0,g.ll)`${a} <> ${h(b,a)}`;function k(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" and ")),new g.DJ(")")])}function l(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" or ")),new g.DJ(")")])}function m(a){return(0,g.ll)`not ${a}`}let n=(a,b)=>(0,g.ll)`${a} > ${h(b,a)}`,o=(a,b)=>(0,g.ll)`${a} >= ${h(b,a)}`,p=(a,b)=>(0,g.ll)`${a} < ${h(b,a)}`,q=(a,b)=>(0,g.ll)`${a} <= ${h(b,a)}`;function r(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`false`:(0,g.ll)`${a} in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} in ${h(b,a)}`}function s(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`true`:(0,g.ll)`${a} not in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} not in ${h(b,a)}`}function t(a){return(0,g.ll)`${a} is null`}function u(a){return(0,g.ll)`${a} is not null`}function v(a){return(0,g.ll)`exists ${a}`}function w(a){return(0,g.ll)`not exists ${a}`}function x(a,b,c){return(0,g.ll)`${a} between ${h(b,a)} and ${h(c,a)}`}function y(a,b,c){return(0,g.ll)`${a} not between ${h(b,a)} and ${h(c,a)}`}function z(a,b){return(0,g.ll)`${a} like ${b}`}function A(a,b){return(0,g.ll)`${a} not like ${b}`}function B(a,b){return(0,g.ll)`${a} ilike ${b}`}function C(a,b){return(0,g.ll)`${a} not ilike ${b}`}},49122:(a,b,c)=>{c.d(b,{A:()=>au});var d=c(21820),e=c(29021);let f=new Map,g=new Map,h=Symbol("OriginError"),i={};class j extends Promise{constructor(a,b,c,d,e={}){let g,i;super((a,b)=>{g=a,i=b}),this.tagged=Array.isArray(a.raw),this.strings=a,this.args=b,this.handler=c,this.canceller=d,this.options=e,this.state=null,this.statement=null,this.resolve=a=>(this.active=!1,g(a)),this.reject=a=>(this.active=!1,i(a)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[h]=this.handler.debug?Error():this.tagged&&function(a){if(f.has(a))return f.get(a);let b=Error.stackTraceLimit;return Error.stackTraceLimit=4,f.set(a,Error()),Error.stackTraceLimit=b,f.get(a)}(this.strings)}get origin(){return(this.handler.debug?this[h].stack:this.tagged&&g.has(this.strings)?g.get(this.strings):g.set(this.strings,this[h].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(a=1,b){let c;return(this.options.simple=!1,"function"==typeof a&&(b=a,a=1),this.cursorRows=a,"function"==typeof b)?(this.cursorFn=b,this):{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};c&&c();let a=new Promise((a,b)=>{this.cursorFn=b=>(a({value:b,done:!1}),new Promise(a=>c=a)),this.resolve=()=>(this.active=!1,a({done:!0})),this.reject=a=>(this.active=!1,b(a))});return this.execute(),a},return:()=>(c&&c(i),{done:!0})})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw Error(".stream has been renamed to .forEach")}forEach(a){return this.forEachFn=a,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}class k extends Error{constructor(a){super(a.message),this.name=this.constructor.name,Object.assign(this,a)}}let l={connection:function a(b,c,d){let{host:e,port:f}=d||c,g=Object.assign(Error("write "+b+" "+(c.path||e+":"+f)),{code:b,errno:b,address:c.path||e},c.path?{}:{port:f});return Error.captureStackTrace(g,a),g},postgres:function a(b){let c=new k(b);return Error.captureStackTrace(c,a),c},generic:function a(b,c){let d=Object.assign(Error(b+": "+c),{code:b});return Error.captureStackTrace(d,a),d},notSupported:function a(b){let c=Object.assign(Error(b+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:b});return Error.captureStackTrace(c,a),c}};class m{then(){z()}catch(){z()}finally(){z()}}class n extends m{constructor(a){super(),this.value=F(a)}}class o extends m{constructor(a,b,c){super(),this.value=a,this.type=b,this.array=c}}class p extends m{constructor(a,b){super(),this.first=a,this.rest=b}build(a,b,c,d){let e=y.map(([b,c])=>({fn:c,i:a.search(b)})).sort((a,b)=>a.i-b.i).pop();return -1===e.i?E(this.first,d):e.fn(this.first,this.rest,b,c,d)}}function q(a,b,c,d){let e=a instanceof o?a.value:a;if(void 0===e&&(a instanceof o?a.value=d.transform.undefined:e=a=d.transform.undefined,void 0===e))throw l.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+c.push(a instanceof o?(b.push(a.value),a.array?a.array[a.type||G(a.value)]||a.type||function a(b){return Array.isArray(b)?a(b[0]):1009*("string"==typeof b)}(a.value):a.type):(b.push(a),G(a)))}let r=D({string:{to:25,from:null,serialize:a=>""+a},number:{to:0,from:[21,23,26,700,701],serialize:a=>""+a,parse:a=>+a},json:{to:114,from:[114,3802],serialize:a=>JSON.stringify(a),parse:a=>JSON.parse(a)},boolean:{to:16,from:16,serialize:a=>!0===a?"t":"f",parse:a=>"t"===a},date:{to:1184,from:[1082,1114,1184],serialize:a=>(a instanceof Date?a:new Date(a)).toISOString(),parse:a=>new Date(a)},bytea:{to:17,from:17,serialize:a=>"\\x"+Buffer.from(a).toString("hex"),parse:a=>Buffer.from(a.slice(2),"hex")}});function s(a,b,c,d,e,f){for(let g=1;g<a.strings.length;g++)b+=t(b,c,d,e,f)+a.strings[g],c=a.args[g];return b}function t(a,b,c,d,e){return b instanceof p?b.build(a,c,d,e):b instanceof j?u(b,c,d,e):b instanceof n?b.value:b&&b[0]instanceof j?b.reduce((a,b)=>a+" "+u(b,c,d,e),""):q(b,c,d,e)}function u(a,b,c,d){return a.fragment=!0,s(a,a.strings[0],a.args[0],b,c,d)}function v(a,b,c,d,e){return a.map(a=>"("+d.map(d=>t("values",a[d],b,c,e)).join(",")+")").join(",")}function w(a,b,c,d,e){let f=Array.isArray(a[0]),g=b.length?b.flat():Object.keys(f?a[0]:a);return v(f?a:[a],c,d,g,e)}function x(a,b,c,d,e){let f;return("string"==typeof a&&(a=[a].concat(b)),Array.isArray(a))?E(a,e):(b.length?b.flat():Object.keys(a)).map(b=>((f=a[b])instanceof j?u(f,c,d,e):f instanceof n?f.value:q(f,c,d,e))+" as "+F(e.transform.column.to?e.transform.column.to(b):b)).join(",")}let y=Object.entries({values:w,in:(...a)=>{let b=w(...a);return"()"===b?"(null)":b},select:x,as:x,returning:x,"\\(":x,update:(a,b,c,d,e)=>(b.length?b.flat():Object.keys(a)).map(b=>F(e.transform.column.to?e.transform.column.to(b):b)+"="+t("values",a[b],c,d,e)),insert(a,b,c,d,e){let f=b.length?b.flat():Object.keys(Array.isArray(a)?a[0]:a);return"("+E(f,e)+")values"+v(Array.isArray(a)?a:[a],c,d,f,e)}}).map(([a,b])=>[RegExp("((?:^|[\\s(])"+a+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),b]);function z(){throw l.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}let A=r.serializers,B=r.parsers,C=function(a){let b=D(a||{});return{serializers:Object.assign({},A,b.serializers),parsers:Object.assign({},B,b.parsers)}};function D(a){return Object.keys(a).reduce((b,c)=>(a[c].from&&[].concat(a[c].from).forEach(d=>b.parsers[d]=a[c].parse),a[c].serialize&&(b.serializers[a[c].to]=a[c].serialize,a[c].from&&[].concat(a[c].from).forEach(d=>b.serializers[d]=a[c].serialize)),b),{parsers:{},serializers:{}})}function E(a,{transform:{column:b}}){return a.map(a=>F(b.to?b.to(a):a)).join(",")}let F=function(a){return'"'+a.replace(/"/g,'""').replace(/\./g,'"."')+'"'},G=function a(b){return b instanceof o?b.type:b instanceof Date?1184:b instanceof Uint8Array?17:!0===b||!1===b?16:"bigint"==typeof b?20:Array.isArray(b)?a(b[0]):0},H=/\\/g,I=/"/g,J=function a(b,c,d,e){if(!1===Array.isArray(b))return b;if(!b.length)return"{}";let f=b[0],g=1020===e?";":",";return Array.isArray(f)&&!f.type?"{"+b.map(b=>a(b,c,d,e)).join(g)+"}":"{"+b.map(a=>{if(void 0===a&&void 0===(a=d.transform.undefined))throw l.generic("UNDEFINED_VALUE","Undefined values are not allowed");return null===a?"null":'"'+(c?c(a.type?a.value:a):""+a).replace(H,"\\\\").replace(I,'\\"')+'"'}).join(g)+"}"},K={i:0,char:null,str:"",quoted:!1,last:0},L=a=>{let b=a[0];for(let c=1;c<a.length;c++)b+="_"===a[c]?a[++c].toUpperCase():a[c];return b},M=a=>{let b=a[0].toUpperCase();for(let c=1;c<a.length;c++)b+="_"===a[c]?a[++c].toUpperCase():a[c];return b},N=a=>a.replace(/_/g,"-"),O=a=>a.replace(/([A-Z])/g,"_$1").toLowerCase(),P=a=>(a.slice(0,1)+a.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),Q=a=>a.replace(/-/g,"_");function R(a){return function b(c,d){return"object"==typeof c&&null!==c&&(114===d.type||3802===d.type)?Array.isArray(c)?c.map(a=>b(a,d)):Object.entries(c).reduce((c,[e,f])=>Object.assign(c,{[a(e)]:b(f,d)}),{}):c}}L.column={from:L},L.value={from:R(L)},O.column={to:O};let S={...L};S.column.to=O,M.column={from:M},M.value={from:R(M)},P.column={to:P};let T={...M};T.column.to=P,N.column={from:N},N.value={from:R(N)},Q.column={to:Q};let U={...N};U.column.to=Q;var V=c(91645),W=c(34631),X=c(55511),Y=c(27910),Z=c(74998);class $ extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}let _=function(a=[]){let b=a.slice(),c=0;return{get length(){return b.length-c},remove:a=>{let c=b.indexOf(a);return -1===c?null:(b.splice(c,1),a)},push:a=>(b.push(a),a),shift:()=>{let a=b[c++];return c===b.length?(c=0,b=[]):b[c-1]=void 0,a}}},aa=Buffer.allocUnsafe(256),ab=Object.assign(function(){return ab.i=0,ab},"BCcDdEFfHPpQSX".split("").reduce((a,b)=>{let c=b.charCodeAt(0);return a[b]=()=>(aa[0]=c,ab.i=5,ab),a},{}),{N:"\0",i:0,inc:a=>(ab.i+=a,ab),str(a){let b=Buffer.byteLength(a);return ac(b),ab.i+=aa.write(a,ab.i,b,"utf8"),ab},i16:a=>(ac(2),aa.writeUInt16BE(a,ab.i),ab.i+=2,ab),i32:(a,b)=>(b||0===b?aa.writeUInt32BE(a,b):(ac(4),aa.writeUInt32BE(a,ab.i),ab.i+=4),ab),z:a=>(ac(a),aa.fill(0,ab.i,ab.i+a),ab.i+=a,ab),raw:a=>(aa=Buffer.concat([aa.subarray(0,ab.i),a]),ab.i=aa.length,ab),end(a=1){aa.writeUInt32BE(ab.i-a,a);let b=aa.subarray(0,ab.i);return ab.i=0,aa=Buffer.allocUnsafe(256),b}});function ac(a){if(aa.length-ab.i<a){let b=aa,c=b.length;aa=Buffer.allocUnsafe(c+(c>>1)+a),b.copy(aa)}}let ad=function a(b,c={},{onopen:d=ak,onend:e=ak,onclose:f=ak}={}){let{ssl:g,max:h,user:k,host:m,port:n,database:o,parsers:p,transform:r,onnotice:t,onnotify:u,onparameter:v,max_pipeline:w,keep_alive:x,backoff:y,target_session_attrs:z}=b,A=_(),B=ae++,C={pid:null,secret:null},D=aq(aU,b.idle_timeout),E=aq(aU,b.max_lifetime),F=aq(function(){aS(l.connection("CONNECT_TIMEOUT",b,G)),G.destroy()},b.connect_timeout),G=null,H,I=new $,L=Buffer.alloc(0),M=b.fetch_types,N={},O={},P=Math.random().toString(36).slice(2),Q=1,R=0,S=0,T=0,U=0,aa=0,ac=0,ad=0,am=null,ar=null,as=!1,at=null,au=null,av=null,aw=null,ax=null,ay=null,az=null,aA=null,aB=null,aC=null,aD={queue:c.closed,idleTimer:D,connect(a){av=a,aP()},terminate:aV,execute:aG,cancel:aF,end:aU,count:0,id:B};return c.closed&&c.closed.push(aD),aD;async function aE(){let a;try{a=b.socket?await Promise.resolve(b.socket(b)):new V.Socket}catch(a){aR(a);return}return a.on("error",aR),a.on("close",aW),a.on("drain",aM),a}async function aF({pid:a,secret:b},c,d){try{H=ab().i32(16).i32(0x4d2162e).i32(a).i32(b).end(16),await aO(),G.once("error",d),G.once("close",c)}catch(a){d(a)}}function aG(a){if(as)return aT(a,l.connection("CONNECTION_DESTROYED",b));if(!a.cancelled)try{return a.state=C,aB?A.push(a):(aB=a).active=!0,function(a){let c=[],d=[],e=s(a,a.strings[0],a.args[0],c,d,b);a.tagged||a.args.forEach(a=>q(a,c,d,b)),a.prepare=b.prepare&&(!("prepare"in a.options)||a.options.prepare),a.string=e,a.signature=a.prepare&&d+e,a.onlyDescribe&&delete O[a.signature],a.parameters=a.parameters||c,a.prepared=a.prepare&&a.signature in O,a.describeFirst=a.onlyDescribe||c.length&&!a.prepared,a.statement=a.prepared?O[a.signature]:{string:e,types:d,name:a.prepare?P+Q++:""},"function"==typeof b.debug&&b.debug(B,e,c,d)}(a),aJ(function(a){var b;if(a.parameters.length>=65534)throw l.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return a.options.simple?ab().Q().str(a.statement.string+ab.N).end():a.describeFirst?Buffer.concat([aH(a),ag]):a.prepare?a.prepared?aI(a):Buffer.concat([aH(a),aI(a)]):(b=a,Buffer.concat([a4(b.statement.string,b.parameters,b.statement.types),aj,aI(b)]))}(a))&&!a.describeFirst&&!a.cursorFn&&A.length<w&&(!a.options.onexecute||a.options.onexecute(aD))}catch(a){return 0===A.length&&aJ(af),aS(a),!0}}function aH(a){return Buffer.concat([a4(a.statement.string,a.parameters,a.statement.types,a.statement.name),function(a,b=""){return ab().D().str("S").str(b+ab.N).end()}("S",a.statement.name)])}function aI(a){return Buffer.concat([function(a,c,d="",e=""){let f,g;return ab().B().str(e+ab.N).str(d+ab.N).i16(0).i16(a.length),a.forEach((d,e)=>{if(null===d)return ab.i32(0xffffffff);g=c[e],a[e]=d=g in b.serializers?b.serializers[g](d):""+d,f=ab.i,ab.inc(4).str(d).i32(ab.i-f-4,f)}),ab.i16(0),ab.end()}(a.parameters,a.statement.types,a.statement.name,a.cursorName),a.cursorFn?a5("",a.cursorRows):ai])}function aJ(a,b){return(ay=ay?Buffer.concat([ay,a]):Buffer.from(a),b||ay.length>=1024)?aK(b):(null===ar&&(ar=setImmediate(aK)),!0)}function aK(a){let b=G.write(ay,a);return null!==ar&&clearImmediate(ar),ay=ar=null,b}async function aL(){if(aJ(ah),!await new Promise(a=>G.once("data",b=>a(83===b[0])))&&"prefer"===g)return aQ();G.removeAllListeners(),(G=W.connect({socket:G,servername:V.isIP(G.host)?void 0:G.host,..."require"===g||"allow"===g||"prefer"===g?{rejectUnauthorized:!1}:"verify-full"===g?{}:"object"==typeof g?g:{}})).on("secureConnect",aQ),G.on("error",aR),G.on("close",aW),G.on("drain",aM)}function aM(){aB||d(aD)}function aN(c){if(!at||(at.push(c),!((S-=c.length)>0)))for(L=at?Buffer.concat(at,aa-S):0===L.length?c:Buffer.concat([L,c],L.length+c.length);L.length>4;){if((aa=L.readUInt32BE(1))>=L.length){S=aa-L.length,at=[L];break}try{!function(c,e=c[0]){(68===e?function(a){let b,c,d,e=7,f=aB.isRaw?Array(aB.statement.columns.length):{};for(let g=0;g<aB.statement.columns.length;g++)c=aB.statement.columns[g],b=a.readInt32BE(e),e+=4,d=-1===b?null:!0===aB.isRaw?a.subarray(e,e+=b):void 0===c.parser?a.toString("utf8",e,e+=b):!0===c.parser.array?c.parser(a.toString("utf8",e+1,e+=b)):c.parser(a.toString("utf8",e,e+=b)),aB.isRaw?f[g]=!0===aB.isRaw?d:r.value.from?r.value.from(d,c):d:f[c.name]=r.value.from?r.value.from(d,c):d;aB.forEachFn?aB.forEachFn(r.row.from?r.row.from(f):f,I):I[ad++]=r.row.from?r.row.from(f):f}:100===e?function(a){ax&&(ax.push(a.subarray(5))||G.pause())}:65===e?function(a){if(!u)return;let b=9;for(;0!==a[b++];);u(a.toString("utf8",9,b-1),a.toString("utf8",b,a.length-1))}:83===e?function(a){let[c,d]=a.toString("utf8",5,a.length-1).split(ab.N);N[c]=d,b.parameters[c]!==d&&(b.parameters[c]=d,v&&v(c,d))}:90===e?function(c){if(aB&&aB.options.simple&&aB.resolve(au||I),aB=au=null,I=new $,F.cancel(),av){if(z)if(N.in_hot_standby&&N.default_transaction_read_only){var e,f;if(e=z,f=N,"read-write"===e&&"on"===f.default_transaction_read_only||"read-only"===e&&"off"===f.default_transaction_read_only||"primary"===e&&"on"===f.in_hot_standby||"standby"===e&&"off"===f.in_hot_standby||"prefer-standby"===e&&"off"===f.in_hot_standby&&b.host[U])return aV()}else{let a=new j([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],aG,null,{simple:!0});a.resolve=([[a],[b]])=>{N.default_transaction_read_only=a.transaction_read_only,N.in_hot_standby=b.pg_is_in_recovery?"on":"off"},a.execute();return}return M?(av.reserve&&(av=null),a2()):(av&&!av.reserve&&aG(av),b.shared.retries=U=0,void(av=null))}for(;A.length&&(aB=A.shift())&&(aB.active=!0,aB.cancelled);)a(b).cancel(aB.state,aB.cancelled.resolve,aB.cancelled.reject);aB||(aD.reserved?aD.reserved.release||73!==c[5]?aD.reserved():aw?aV():(aD.reserved=null,d(aD)):aw?aV():d(aD))}:67===e?function(a){ad=0;for(let b=a.length-1;b>0;b--)if(32===a[b]&&a[b+1]<58&&null===I.count&&(I.count=+a.toString("utf8",b+1,a.length-1)),a[b-1]>=65){I.command=a.toString("utf8",5,b),I.state=C;break}return(aC&&(aC(),aC=null),"BEGIN"!==I.command||1===h||aD.reserved)?aB.options.simple?aX():void(aB.cursorFn&&(I.count&&aB.cursorFn(I),aJ(af)),aB.resolve(I)):aS(l.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"))}:50===e?aX:49===e?function(){aB.parsing=!1}:116===e?function(a){let b=a.readUInt16BE(5);for(let c=0;c<b;++c)aB.statement.types[c]||(aB.statement.types[c]=a.readUInt32BE(7+4*c));aB.prepare&&(O[aB.signature]=aB.statement),aB.describeFirst&&!aB.onlyDescribe&&(aJ(aI(aB)),aB.describeFirst=!1)}:84===e?function(a){let b;I.command&&((au=au||[I]).push(I=new $),I.count=null,aB.statement.columns=null);let c=a.readUInt16BE(5),d=7;aB.statement.columns=Array(c);for(let e=0;e<c;++e){for(b=d;0!==a[d++];);let c=a.readUInt32BE(d),f=a.readUInt16BE(d+4),g=a.readUInt32BE(d+6);aB.statement.columns[e]={name:r.column.from?r.column.from(a.toString("utf8",b,d-1)):a.toString("utf8",b,d-1),parser:p[g],table:c,number:f,type:g},d+=18}if(I.statement=aB.statement,aB.onlyDescribe)return aB.resolve(aB.statement),aJ(af)}:82===e?aY:110===e?function(){if(I.statement=aB.statement,I.statement.columns=[],aB.onlyDescribe)return aB.resolve(aB.statement),aJ(af)}:75===e?function(a){C.pid=a.readUInt32BE(5),C.secret=a.readUInt32BE(9)}:69===e?function(a){var b,c;aB&&(aB.cursorFn||aB.describeFirst)&&aJ(af);let d=l.postgres(an(a));aB&&aB.retried?aS(aB.retried):aB&&aB.prepared&&al.has(d.routine)?(b=aB,c=d,delete O[b.signature],b.retried=c,aG(b)):aS(d)}:115===e?a3:51===e?function(){I.count&&aB.cursorFn(I),aB.resolve(I)}:71===e?function(){ax=new Y.Writable({autoDestroy:!0,write(a,b,c){G.write(ab().d().raw(a).end(),c)},destroy(a,b){b(a),G.write(ab().f().str(a+ab.N).end()),ax=null},final(a){G.write(ab().c().end()),aC=a}}),aB.resolve(ax)}:78===e?function(a){t?t(an(a)):console.log(an(a))}:72===e?function(){ax=new Y.Readable({read(){G.resume()}}),aB.resolve(ax)}:99===e?function(){ax&&ax.push(null),ax=null}:73===e?function(){}:86===e?function(){aS(l.notSupported("FunctionCallResponse"))}:118===e?function(){aS(l.notSupported("NegotiateProtocolVersion"))}:87===e?function(){ax=new Y.Duplex({autoDestroy:!0,read(){G.resume()},write(a,b,c){G.write(ab().d().raw(a).end(),c)},destroy(a,b){b(a),G.write(ab().f().str(a+ab.N).end()),ax=null},final(a){G.write(ab().c().end()),aC=a}}),aB.resolve(ax)}:function(a){console.error("Postgres.js : Unknown Message:",a[0])})(c)}(L.subarray(0,aa+1))}catch(a){aB&&(aB.cursorFn||aB.describeFirst)&&aJ(af),aS(a)}L=L.subarray(aa+1),S=0,at=null}}async function aO(){if(as=!1,N={},G||(G=await aE()),G){if(F.start(),b.socket)return g?aL():aQ();if(G.on("connect",g?aL:aQ),b.path)return G.connect(b.path);G.ssl=g,G.connect(n[T],m[T]),G.host=m[T],G.port=n[T],T=(T+1)%n.length}}function aP(){setTimeout(aO,R?R+ac-Z.performance.now():0)}function aQ(){try{O={},M=b.fetch_types,P=Math.random().toString(36).slice(2),Q=1,E.start(),G.on("data",aN),x&&G.setKeepAlive&&G.setKeepAlive(!0,1e3*x);let a=H||ab().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:k,database:o,client_encoding:"UTF8"},b.connection)).filter(([,a])=>a).map(([a,b])=>a+ab.N+b).join(ab.N)).z(2).end(0);aJ(a)}catch(a){aR(a)}}function aR(a){if(aD.queue!==c.connecting||!b.host[U+1])for(aS(a);A.length;)aT(A.shift(),a)}function aS(a){ax&&(ax.destroy(a),ax=null),aB&&aT(aB,a),av&&(aT(av,a),av=null)}function aT(a,c){if(a.reserve)return a.reject(c);c&&"object"==typeof c||(c=Error(c)),"query"in c||"parameters"in c||Object.defineProperties(c,{stack:{value:c.stack+a.origin.replace(/.*\n/,"\n"),enumerable:b.debug},query:{value:a.string,enumerable:b.debug},parameters:{value:a.parameters,enumerable:b.debug},args:{value:a.args,enumerable:b.debug},types:{value:a.statement&&a.statement.types,enumerable:b.debug}}),a.reject(c)}function aU(){return aw||(aD.reserved||e(aD),aD.reserved||av||aB||0!==A.length?aw=new Promise(a=>az=a):(aV(),new Promise(a=>G&&"closed"!==G.readyState?G.once("close",a):a())))}function aV(){as=!0,(ax||aB||av||A.length)&&aR(l.connection("CONNECTION_DESTROYED",b)),clearImmediate(ar),G&&(G.removeListener("data",aN),G.removeListener("connect",aQ),"open"===G.readyState&&G.end(ab().X().end())),az&&(az(),aw=az=null)}async function aW(a){if(L=Buffer.alloc(0),S=0,at=null,clearImmediate(ar),G.removeListener("data",aN),G.removeListener("connect",aQ),D.cancel(),E.cancel(),F.cancel(),G.removeAllListeners(),G=null,av)return aP();!a&&(aB||A.length)&&aR(l.connection("CONNECTION_CLOSED",b,G)),R=Z.performance.now(),a&&b.shared.retries++,ac=("function"==typeof y?y(b.shared.retries):y)*1e3,f(aD,l.connection("CONNECTION_CLOSED",b,G))}function aX(){I.statement||(I.statement=aB.statement),I.columns=aB.statement.columns}async function aY(a,b=a.readUInt32BE(5)){(3===b?aZ:5===b?a$:10===b?a_:11===b?a0:12===b?function(a){a.toString("utf8",9).split(ab.N,1)[0].slice(2)!==am&&(aS(l.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),G.destroy())}:0!==b?function(a,b){console.error("Postgres.js : Unknown Auth:",b)}:ak)(a,b)}async function aZ(){let a=await a1();aJ(ab().p().str(a).z(1).end())}async function a$(a){let b="md5"+await ao(Buffer.concat([Buffer.from(await ao(await a1()+k)),a.subarray(9)]));aJ(ab().p().str(b).z(1).end())}async function a_(){aA=(await X.randomBytes(18)).toString("base64"),ab().p().str("SCRAM-SHA-256"+ab.N);let a=ab.i;aJ(ab.inc(4).str("n,,n=*,r="+aA).i32(ab.i-a-4,a).end())}async function a0(a){var b;let c=a.toString("utf8",9).split(",").reduce((a,b)=>(a[b[0]]=b.slice(2),a),{}),d=await X.pbkdf2Sync(await a1(),Buffer.from(c.s,"base64"),parseInt(c.i),32,"sha256"),e=await ap(d,"Client Key"),f="n=*,r="+aA+",r="+c.r+",s="+c.s+",i="+c.i+",c=biws,r="+c.r;am=(await ap(await ap(d,"Server Key"),f)).toString("base64");let g="c=biws,r="+c.r+",p="+(function(a,b){let c=Math.max(a.length,b.length),d=Buffer.allocUnsafe(c);for(let e=0;e<c;e++)d[e]=a[e]^b[e];return d})(e,Buffer.from(await ap(await (b=e,X.createHash("sha256").update(b).digest()),f))).toString("base64");aJ(ab().p().str(g).end())}function a1(){return Promise.resolve("function"==typeof b.pass?b.pass():b.pass)}async function a2(){M=!1,(await new j([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],aG)).forEach(({oid:a,typarray:c})=>(function(a,c){if(b.parsers[c]&&b.serializers[c])return;let d=b.parsers[a];b.shared.typeArrayMap[a]=c,b.parsers[c]=a=>(K.i=K.last=0,function a(b,c,d,e){let f=[],g=1020===e?";":",";for(;b.i<c.length;b.i++){if(b.char=c[b.i],b.quoted)"\\"===b.char?b.str+=c[++b.i]:'"'===b.char?(f.push(d?d(b.str):b.str),b.str="",b.quoted='"'===c[b.i+1],b.last=b.i+2):b.str+=b.char;else if('"'===b.char)b.quoted=!0;else if("{"===b.char)b.last=++b.i,f.push(a(b,c,d,e));else if("}"===b.char){b.quoted=!1,b.last<b.i&&f.push(d?d(c.slice(b.last,b.i)):c.slice(b.last,b.i)),b.last=b.i+1;break}else b.char===g&&"}"!==b.p&&'"'!==b.p&&(f.push(d?d(c.slice(b.last,b.i)):c.slice(b.last,b.i)),b.last=b.i+1);b.p=b.char}return b.last<b.i&&f.push(d?d(c.slice(b.last,b.i+1)):c.slice(b.last,b.i+1)),f}(K,a,d,c)),b.parsers[c].array=!0,b.serializers[c]=d=>J(d,b.serializers[a],b,c)})(a,c))}async function a3(){try{let a=await Promise.resolve(aB.cursorFn(I));ad=0,a===i?aJ(function(a=""){return Buffer.concat([ab().C().str("P").str(a+ab.N).end(),ab().S().end()])}(aB.portal)):(I=new $,aJ(a5("",aB.cursorRows)))}catch(a){aJ(af),aB.reject(a)}}function a4(a,b,c,d=""){return ab().P().str(d+ab.N).str(a+ab.N).i16(b.length),b.forEach((a,b)=>ab.i32(c[b]||0)),ab.end()}function a5(a="",b=0){return Buffer.concat([ab().E().str(a+ab.N).i32(b).end(),ag])}},ae=1,af=ab().S().end(),ag=ab().H().end(),ah=ab().i32(8).i32(0x4d2162f).end(8),ai=Buffer.concat([ab().E().str(ab.N).i32(0).end(),af]),aj=ab().D().str("S").str(ab.N).end(),ak=()=>{},al=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),am={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function an(a){let b={},c=5;for(let d=5;d<a.length-1;d++)0===a[d]&&(b[am[a[c]]]=a.toString("utf8",c+1,d),c=d+1);return b}function ao(a){return X.createHash("md5").update(a).digest("hex")}function ap(a,b){return X.createHmac("sha256",a).update(b).digest()}function aq(a,b){let c;if(!(b="function"==typeof b?b():b))return{cancel:ak,start:ak};return{cancel(){c&&(clearTimeout(c),c=null)},start(){c&&clearTimeout(c),c=setTimeout(d,1e3*b,arguments)}};function d(b){a.apply(null,b),c=null}}let ar=()=>{};function as(a,b,c,d){let e,f,g,h=d.raw?Array(b.length):{};for(let i=0;i<b.length;i++)e=a[c++],f=b[i],g=110===e?null:117===e?void 0:void 0===f.parser?a.toString("utf8",c+4,c+=4+a.readUInt32BE(c)):!0===f.parser.array?f.parser(a.toString("utf8",c+5,c+=4+a.readUInt32BE(c))):f.parser(a.toString("utf8",c+4,c+=4+a.readUInt32BE(c))),d.raw?h[i]=!0===d.raw?g:d.value.from?d.value.from(g,f):g:h[f.name]=d.value.from?d.value.from(g,f):g;return{i:c,row:d.row.from?d.row.from(h):h}}function at(a,b,c=393216){return new Promise(async(d,e)=>{await a.begin(async a=>{let e;b||([{oid:b}]=await a`select lo_creat(-1) as oid`);let[{fd:f}]=await a`select lo_open(${b}, ${c}) as fd`,g={writable:i,readable:h,close:()=>a`select lo_close(${f})`.then(e),tell:()=>a`select lo_tell64(${f})`,read:b=>a`select loread(${f}, ${b}) as data`,write:b=>a`select lowrite(${f}, ${b})`,truncate:b=>a`select lo_truncate64(${f}, ${b})`,seek:(b,c=0)=>a`select lo_lseek64(${f}, ${b}, ${c})`,size:()=>a`
          select
            lo_lseek64(${f}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return d(g),new Promise(async a=>e=a);async function h({highWaterMark:a=16384,start:b=0,end:c=1/0}={}){let d=c-b;return b&&await g.seek(b),new Y.Readable({highWaterMark:a,async read(a){let b=a>d?a-d:a;d-=a;let[{data:c}]=await g.read(b);this.push(c),c.length<a&&this.push(null)}})}async function i({highWaterMark:a=16384,start:b=0}={}){return b&&await g.seek(b),new Y.Writable({highWaterMark:a,write(a,b,c){g.write(a).then(()=>c(),c)}})}}).catch(e)})}Object.assign(av,{PostgresError:k,toPascal:M,pascal:T,toCamel:L,camel:S,toKebab:N,kebab:U,fromPascal:P,fromCamel:O,fromKebab:Q,BigInt:{to:20,from:[20],parse:a=>BigInt(a),serialize:a=>a.toString()}});let au=av;function av(a,b){let c=function(a,b){var c;if(a&&a.shared)return a;let e=process.env,f=(a&&"string"!=typeof a?a:b)||{},{url:g,multihost:h}=function(a){if(!a||"string"!=typeof a)return{url:{searchParams:new Map}};let b=a;b=decodeURIComponent((b=b.slice(b.indexOf("://")+3).split(/[?/]/)[0]).slice(b.indexOf("@")+1));let c=new URL(a.replace(b,b.split(",")[0]));return{url:{username:decodeURIComponent(c.username),password:decodeURIComponent(c.password),host:c.host,hostname:c.hostname,port:c.port,pathname:c.pathname,searchParams:c.searchParams},multihost:b.indexOf(",")>-1&&b}}(a),i=[...g.searchParams].reduce((a,[b,c])=>(a[b]=c,a),{}),j=f.hostname||f.host||h||g.hostname||e.PGHOST||"localhost",k=f.port||g.port||e.PGPORT||5432,l=f.user||f.username||g.username||e.PGUSERNAME||e.PGUSER||function(){try{return d.userInfo().username}catch(a){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}();f.no_prepare&&(f.prepare=!1),i.sslmode&&(i.ssl=i.sslmode,delete i.sslmode),"timeout"in f&&(console.log("The timeout option is deprecated, use idle_timeout instead"),f.idle_timeout=f.timeout),"system"===i.sslrootcert&&(i.ssl="verify-full");let m=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],n={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:ax,max_pipeline:100,backoff:aw,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(j)?j:j.split(",").map(a=>a.split(":")[0]),port:Array.isArray(k)?k:j.split(",").map(a=>parseInt(a.split(":")[1]||k)),path:f.path||j.indexOf("/")>-1&&j+"/.s.PGSQL."+k,database:f.database||f.db||(g.pathname||"").slice(1)||e.PGDATABASE||l,user:l,pass:f.pass||f.password||g.password||e.PGPASSWORD||"",...Object.entries(n).reduce((a,[b,c])=>{let d=b in f?f[b]:b in i?"disable"!==i[b]&&"false"!==i[b]&&i[b]:e["PG"+b.toUpperCase()]||c;return a[b]="string"==typeof d&&m.includes(b)?+d:d,a},{}),connection:{application_name:e.PGAPPNAME||"postgres.js",...f.connection,...Object.entries(i).reduce((a,[b,c])=>(b in n||(a[b]=c),a),{})},types:f.types||{},target_session_attrs:function(a,b,c){let d=a.target_session_attrs||b.searchParams.get("target_session_attrs")||c.PGTARGETSESSIONATTRS;if(!d||["read-write","read-only","primary","standby","prefer-standby"].includes(d))return d;throw Error("target_session_attrs "+d+" is not supported")}(f,g,e),onnotice:f.onnotice,onnotify:f.onnotify,onclose:f.onclose,onparameter:f.onparameter,socket:f.socket,transform:{undefined:(c=f.transform||{undefined:void 0}).undefined,column:{from:"function"==typeof c.column?c.column:c.column&&c.column.from,to:c.column&&c.column.to},value:{from:"function"==typeof c.value?c.value:c.value&&c.value.from,to:c.value&&c.value.to},row:{from:"function"==typeof c.row?c.row:c.row&&c.row.from,to:c.row&&c.row.to}},parameters:{},shared:{retries:0,typeArrayMap:{}},...C(f.types)}}(a,b),f=c.no_subscribe||function(a,b){let c=new Map,d="postgresjs_"+Math.random().toString(36).slice(2),e={},f,g,h=!1,i=l.sql=a({...b,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...b.connection,replication:"database"},onclose:async function(){h||(g=null,e.pid=e.secret=void 0,m(await n(i,d,b.publications)),c.forEach(a=>a.forEach(({onsubscribe:a})=>a())))},no_subscribe:!0}),j=i.end,k=i.close;return i.end=async()=>(h=!0,g&&await new Promise(a=>(g.once("close",a),g.end())),j()),i.close=async()=>(g&&await new Promise(a=>(g.once("close",a),g.end())),k()),l;async function l(a,h,j=ar,k=ar){a=function(a){let b=a.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!b)throw Error("Malformed subscribe pattern: "+a);let[,c,d,e]=b;return(c||"*")+(d?":"+(-1===d.indexOf(".")?"public."+d:d):"")+(e?"="+e:"")}(a),f||(f=n(i,d,b.publications));let o={fn:h,onsubscribe:j},p=c.has(a)?c.get(a).add(o):c.set(a,new Set([o])).get(a),q=()=>{p.delete(o),0===p.size&&c.delete(a)};return f.then(a=>(m(a),j(),g&&g.on("error",k),{unsubscribe:q,state:e,sql:i}))}function m(a){g=a.stream,e.pid=a.state.pid,e.secret=a.state.secret}async function n(a,c,d){if(!d)throw Error("Missing publication names");let e=await a.unsafe(`CREATE_REPLICATION_SLOT ${c} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[f]=e,g=await a.unsafe(`START_REPLICATION SLOT ${c} LOGICAL ${f.consistent_point} (proto_version '1', publication_names '${d}')`).writable(),h={lsn:Buffer.concat(f.consistent_point.split("/").map(a=>Buffer.from(("00000000"+a).slice(-8),"hex")))};return g.on("data",function(c){var d,e,f,j,k;119===c[0]?(d=c.subarray(25),e=h,f=a.options.parsers,j=i,k=b.transform,Object.entries({R:a=>{let b=1,c=e[a.readUInt32BE(b)]={schema:a.toString("utf8",b+=4,b=a.indexOf(0,b))||"pg_catalog",table:a.toString("utf8",b+1,b=a.indexOf(0,b+1)),columns:Array(a.readUInt16BE(b+=2)),keys:[]};b+=2;let d=0,g;for(;b<a.length;)(g=c.columns[d++]={key:a[b++],name:k.column.from?k.column.from(a.toString("utf8",b,b=a.indexOf(0,b))):a.toString("utf8",b,b=a.indexOf(0,b)),type:a.readUInt32BE(b+=1),parser:f[a.readUInt32BE(b)],atttypmod:a.readUInt32BE(b+=4)}).key&&c.keys.push(g),b+=4},Y:()=>{},O:()=>{},B:a=>{var b;b=a.readBigInt64BE(9),e.date=new Date(Date.UTC(2e3,0,1)+Number(b/BigInt(1e3))),e.lsn=a.subarray(1,9)},I:a=>{let b=1,c=e[a.readUInt32BE(b)],{row:d}=as(a,c.columns,b+=7,k);j(d,{command:"insert",relation:c})},D:a=>{let b=1,c=e[a.readUInt32BE(b)],d=75===a[b+=4];j(d||79===a[b]?as(a,c.columns,b+=3,k).row:null,{command:"delete",relation:c,key:d})},U:a=>{let b=1,c=e[a.readUInt32BE(b)],d=75===a[b+=4],f=d||79===a[b]?as(a,c.columns,b+=3,k):null;f&&(b=f.i);let{row:g}=as(a,c.columns,b+3,k);j(g,{command:"update",relation:c,key:d,old:f&&f.row})},T:()=>{},C:()=>{}}).reduce((a,[b,c])=>(a[b.charCodeAt(0)]=c,a),{})[d[0]](d)):107===c[0]&&c[17]&&(h.lsn=c.subarray(1,9),function(){let a=Buffer.alloc(34);a[0]=114,a.fill(h.lsn,1),a.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),g.write(a)}())}),g.on("error",function(a){console.error("Unexpected error during logical streaming - reconnecting",a)}),g.on("close",a.close),{stream:g,state:e.state};function i(a,b){let c=b.relation.schema+"."+b.relation.table;o("*",a,b),o("*:"+c,a,b),b.relation.keys.length&&o("*:"+c+"="+b.relation.keys.map(b=>a[b.name]),a,b),o(b.command,a,b),o(b.command+":"+c,a,b),b.relation.keys.length&&o(b.command+":"+c+"="+b.relation.keys.map(b=>a[b.name]),a,b)}}function o(a,b,d){c.has(a)&&c.get(a).forEach(({fn:c})=>c(b,d,a))}}(av,{...c}),g=!1,h=_(),m=_(),q=_(),r=_(),s=_(),t=_(),u=_(),v=_(),w={connecting:m,reserved:q,closed:r,ended:s,open:t,busy:u,full:v},x=[...Array(c.max)].map(()=>ad(c,w,{onopen:P,onend:O,onclose:Q})),y=z(function(a){return g?a.reject(l.connection("CONNECTION_ENDED",c,c)):t.length?I(t.shift(),a):r.length?N(r.shift(),a):void(u.length?I(u.shift(),a):h.push(a))});return Object.assign(y,{get parameters(){return c.parameters},largeObject:at.bind(null,y),subscribe:f,CLOSE:i,END:i,PostgresError:k,options:c,reserve:D,listen:A,begin:E,close:L,end:K}),y;function z(a){return a.debug=c.debug,Object.entries(c.types).reduce((a,[b,c])=>(a[b]=a=>new o(a,c.to),a),b),Object.assign(d,{types:b,typed:b,unsafe:function(b,c=[],d={}){return 2!=arguments.length||Array.isArray(c)||(d=c,c=[]),new j([b],c,a,J,{prepare:!1,...d,simple:"simple"in d?d.simple:0===c.length})},notify:B,array:function a(b,d){return Array.isArray(b)?new o(b,d||(b.length?G(b)||25:0),c.shared.typeArrayMap):a(Array.from(arguments))},json:H,file:function(b,c=[],d={}){return 2!=arguments.length||Array.isArray(c)||(d=c,c=[]),new j([],c,c=>{e.readFile(b,"utf8",(b,d)=>{if(b)return c.reject(b);c.strings=[d],a(c)})},J,{...d,simple:"simple"in d?d.simple:0===c.length})}}),d;function b(a,b){return new o(a,b)}function d(b,...e){return b&&Array.isArray(b.raw)?new j(b,e,a,J):"string"!=typeof b||e.length?new p(b,e):new n(c.transform.column.to?c.transform.column.to(b):b)}}async function A(a,b,d){let e={fn:b,onlisten:d},f=A.sql||(A.sql=av({...c,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(A.channels).forEach(([a,{listeners:b}])=>{delete A.channels[a],Promise.all(b.map(b=>A(a,b.fn,b.onlisten).catch(()=>{})))})},onnotify(a,b){a in A.channels&&A.channels[a].listeners.forEach(a=>a.fn(b))}})),g=A.channels||(A.channels={});if(a in g){g[a].listeners.push(e);let b=await g[a].result;return e.onlisten&&e.onlisten(),{state:b.state,unlisten:i}}g[a]={result:f`listen ${f.unsafe('"'+a.replace(/"/g,'""')+'"')}`,listeners:[e]};let h=await g[a].result;return e.onlisten&&e.onlisten(),{state:h.state,unlisten:i};async function i(){if(a in g!=!1&&(g[a].listeners=g[a].listeners.filter(a=>a!==e),!g[a].listeners.length))return delete g[a],f`unlisten ${f.unsafe('"'+a.replace(/"/g,'""')+'"')}`}}async function B(a,b){return await y`select pg_notify(${a}, ${""+b})`}async function D(){let a=_(),b=t.length?t.shift():await new Promise((a,b)=>{let c={reserve:a,reject:b};h.push(c),r.length&&N(r.shift(),c)});F(b,q),b.reserved=()=>a.length?b.execute(a.shift()):F(b,q),b.reserved.release=!0;let c=z(function(c){b.queue===v?a.push(c):b.execute(c)||F(b,v)});return c.release=()=>{b.reserved=null,P(b)},c}async function E(a,b){b||(b=a,a="");let c=_(),d=0,e,f=null;try{return await y.unsafe("begin "+a.replace(/[^a-z ]/ig,""),[],{onexecute:function(a){e=a,F(a,q),a.reserved=()=>c.length?a.execute(c.shift()):F(a,q)}}).execute(),await Promise.race([g(e,b),new Promise((a,b)=>e.onclose=b)])}catch(a){throw a}async function g(a,b,e){let h,i,j=z(function(b){b.catch(a=>h||(h=a)),a.queue===v?c.push(b):a.execute(b)||F(a,v)});j.savepoint=function b(c,e){return c&&Array.isArray(c.raw)?b(a=>a.apply(a,arguments)):(1==arguments.length&&(e=c,c=null),g(a,e,"s"+d+++(c?"_"+c:"")))},j.prepare=a=>f=a.replace(/[^a-z0-9$-_. ]/gi),e&&await j`savepoint ${j(e)}`;try{if(i=await new Promise((a,c)=>{let d=b(j);Promise.resolve(Array.isArray(d)?Promise.all(d):d).then(a,c)}),h)throw h}catch(a){throw await (e?j`rollback to ${j(e)}`:j`rollback`),a instanceof k&&"25P02"===a.code&&h||a}return e||(f?await j`prepare transaction '${j.unsafe(f)}'`:await j`commit`),i}}function F(a,b){return a.queue.remove(a),b.push(a),a.queue=b,b===t?a.idleTimer.start():a.idleTimer.cancel(),a}function H(a){return new o(a,3802)}function I(a,b){return a.execute(b)?F(a,u):F(a,v)}function J(a){return new Promise((b,d)=>{a.state?a.active?ad(c).cancel(a.state,b,d):a.cancelled={resolve:b,reject:d}:(h.remove(a),a.cancelled=!0,a.reject(l.generic("57014","canceling statement due to user request")),b())})}async function K({timeout:a=null}={}){let b;return g||(await 1,g=Promise.race([new Promise(c=>null!==a&&(b=setTimeout(M,1e3*a,c))),Promise.all(x.map(a=>a.end()).concat(A.sql?A.sql.end({timeout:0}):[],f.sql?f.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(b)))}async function L(){await Promise.all(x.map(a=>a.end()))}async function M(a){for(await Promise.all(x.map(a=>a.terminate()));h.length;)h.shift().reject(l.connection("CONNECTION_DESTROYED",c));a()}function N(a,b){return F(a,m),a.connect(b),a}function O(a){F(a,s)}function P(a){if(0===h.length)return F(a,t);let b=Math.ceil(h.length/(m.length+1)),c=!0;for(;c&&h.length&&b-- >0;){let b=h.shift();if(b.reserve)return b.reserve(a);c=a.execute(b)}c?F(a,u):F(a,v)}function Q(a,b){F(a,r),a.reserved=null,a.onclose&&(a.onclose(b),a.onclose=null),c.onclose&&c.onclose(a.id),h.length&&N(a,h.shift())}}function aw(a){return(.5+Math.random()/2)*Math.min(3**a/100,20)}function ax(){return 60*(30+30*Math.random())}},50047:(a,b,c)=>{c.d(b,{Ct:()=>v,DJ:()=>m,Iw:()=>s,Or:()=>u,Ss:()=>w,Xs:()=>n,eG:()=>p,ll:()=>t,qt:()=>l});var d=c(46493),e=c(75947),f=c(96176),g=c(27017),h=c(19593),i=c(80228),j=c(7284);class k{static [d.i]=null}function l(a){return null!=a&&"function"==typeof a.getSQL}class m{static [d.i]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new n([this])}}class n{constructor(a){this.queryChunks=a}static [d.i]="SQL";decoder=q;shouldInlineParams=!1;append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return g.k.startActiveSpan("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:g,escapeName:k,escapeParam:p,prepareTyping:q,inlineParams:r,paramStartIndex:t}=c;var v=a.map(a=>{if((0,d.is)(a,m))return{sql:a.value.join(""),params:[]};if((0,d.is)(a,o))return{sql:k(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new m("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new m(", "));return b.push(new m(")")),this.buildQueryFromSourceParams(b,c)}if((0,d.is)(a,n))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:r||a.shouldInlineParams});if((0,d.is)(a,j.XI)){let b=a[j.XI.Symbol.Schema],c=a[j.XI.Symbol.Name];return{sql:void 0===b?k(c):k(b)+"."+k(c),params:[]}}if((0,d.is)(a,i.V)){let c=g.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:k(c),params:[]};let d=a.table[j.XI.Symbol.Schema];return{sql:a.table[j.HE]||void 0===d?k(a.table[j.XI.Symbol.Name])+"."+k(c):k(d)+"."+k(a.table[j.XI.Symbol.Name])+"."+k(c),params:[]}}if((0,d.is)(a,w)){let b=a[h.n].schema,c=a[h.n].name;return{sql:void 0===b?k(c):k(b)+"."+k(c),params:[]}}if((0,d.is)(a,s)){if((0,d.is)(a.value,u))return{sql:p(t.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if((0,d.is)(b,n))return this.buildQueryFromSourceParams([b],c);if(r)return{sql:this.mapInlineParam(b,c),params:[]};let e=["none"];return q&&(e=[q(a.encoder)]),{sql:p(t.value++,b),params:[b],typings:e}}return(0,d.is)(a,u)?{sql:p(t.value++,a),params:[a],typings:["none"]}:(0,d.is)(a,n.Aliased)&&void 0!==a.fieldAlias?{sql:k(a.fieldAlias),params:[]}:(0,d.is)(a,f.n)?a._.isWith?{sql:k(a._.alias),params:[]}:this.buildQueryFromSourceParams([new m("("),a._.sql,new m(") "),new o(a._.alias)],c):(0,e.BU)(a)?a.schema?{sql:k(a.schema)+"."+k(a.enumName),params:[]}:{sql:k(a.enumName),params:[]}:l(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new m("("),a.getSQL(),new m(")")],c):r?{sql:this.mapInlineParam(a,c),params:[]}:{sql:p(t.value++,a),params:[a],typings:["none"]}});let x={sql:"",params:[]};for(let a of v)x.sql+=a.sql,x.params.push(...a.params),a.typings?.length&&(x.typings||(x.typings=[]),x.typings.push(...a.typings));return x}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new n.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class o{constructor(a){this.value=a}static [d.i]="Name";brand;getSQL(){return new n([this])}}function p(a){return"object"==typeof a&&null!==a&&"mapToDriverValue"in a&&"function"==typeof a.mapToDriverValue}let q={mapFromDriverValue:a=>a},r={mapToDriverValue:a=>a};({...q,...r});class s{constructor(a,b=r){this.value=a,this.encoder=b}static [d.i]="Param";brand;getSQL(){return new n([this])}}function t(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new m(a[0])),b.entries()))c.push(e,new m(a[d+1]));return new n(c)}(a=>{a.empty=function(){return new n([])},a.fromList=function(a){return new n(a)},a.raw=function(a){return new n([new m(a)])},a.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new n(c)},a.identifier=function(a){return new o(a)},a.placeholder=function(a){return new u(a)},a.param=function(a,b){return new s(a,b)}})(t||(t={})),(a=>{class b{constructor(a,b){this.sql=a,this.fieldAlias=b}static [d.i]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new b(this.sql,this.fieldAlias)}}a.Aliased=b})(n||(n={}));class u{constructor(a){this.name=a}static [d.i]="Placeholder";getSQL(){return new n([this])}}function v(a,b){return a.map(a=>{if((0,d.is)(a,u)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if((0,d.is)(a,s)&&(0,d.is)(a.value,u)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}class w{static [d.i]="View";[h.n];constructor({name:a,schema:b,selectedFields:c,query:d}){this[h.n]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new n([this])}}i.V.prototype.getSQL=function(){return new n([this])},j.XI.prototype.getSQL=function(){return new n([this])},f.n.prototype.getSQL=function(){return new n([this])}},57789:(a,b,c)=>{c.d(b,{yf:()=>i});var d=c(46493),e=c(41313),f=c(59048);class g extends f.pe{static [d.i]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function i(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return new g(c,d)}},59048:(a,b,c)=>{c.d(b,{Kl:()=>q,pe:()=>p});var d=c(46493);class e{static [d.i]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}var f=c(80228),g=c(35071);class h{static [d.i]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new i(a,this)}}class i{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [d.i]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[g.E],...d,c[0].table[g.E],...e];return a??`${f.join("_")}_fk`}}var j=c(47878);function k(a,b){return`${a[g.E]}_${b.join("_")}_unique`}class l{constructor(a,b){this.name=b,this.columns=a}static [d.i]=null;columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new n(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class m{static [d.i]=null;name;constructor(a){this.name=a}on(...a){return new l(a,this.name)}}class n{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??k(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [d.i]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}function o(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class p extends e{foreignKeyConfigs=[];static [d.i]="PgColumnBuilder";array(a){return new t(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>(0,j.i)((c,d)=>{let e=new h(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new r(a,this.config)}}class q extends f.V{constructor(a,b){b.uniqueName||(b.uniqueName=k(a,[b.name])),super(a,b),this.table=a}static [d.i]="PgColumn"}class r extends q{static [d.i]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class s{static [d.i]=null;constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class t extends p{static [d.i]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new u(a,this.config,b)}}class u extends q{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [d.i]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=o(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=o(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:(0,d.is)(this.baseColumn,u)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}},59570:(a,b,c)=>{c.d(b,{f:()=>av});var d=c(49122),e=c(46493);class f{static [e.i]="ConsoleLogWriter";write(a){console.log(a)}}class g{static [e.i]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new f}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class h{static [e.i]="NoopLogger";logQuery(){}}var i=c(80228),j=c(50047),k=c(7284),l=c(19593);class m{constructor(a){this.table=a}static [e.i]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class n{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [e.i]="TableAliasProxyHandler";get(a,b){if(b===k.XI.Symbol.IsAlias)return!0;if(b===k.XI.Symbol.Name||this.replaceOriginalName&&b===k.XI.Symbol.OriginalName)return this.alias;if(b===l.n)return{...a[l.n],name:this.alias,isAlias:!0};if(b===k.XI.Symbol.Columns){let b=a[k.XI.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new m(new Proxy(a,this)))}),c}let c=a[b];return(0,e.is)(c,i.V)?new Proxy(c,new m(new Proxy(a,this))):c}}class o{constructor(a){this.alias=a}static [e.i]=null;get(a,b){return"sourceTable"===b?p(a.sourceTable,this.alias):a[b]}}function p(a,b){return new Proxy(a,new n(b,!1))}function q(a,b){return new Proxy(a,new m(new Proxy(a.table,new n(b,!1))))}function r(a,b){return new j.Xs.Aliased(s(a.sql,b),a.fieldAlias)}function s(a,b){return j.ll.join(a.queryChunks.map(a=>(0,e.is)(a,i.V)?q(a,b):(0,e.is)(a,j.Xs)?s(a,b):(0,e.is)(a,j.Xs.Aliased)?r(a,b):a))}function t(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function u(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function v(a){return a}class w{static [e.i]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?t:"camelCase"===a?u:v}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[k.XI.Symbol.Schema]??"public",c=a.table[k.XI.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[k.XI.Symbol.Schema]??"public",c=a[k.XI.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[k.XI.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class x extends Error{static [e.i]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class y extends x{static [e.i]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}var z=c(59048),A=c(94728),B=c(14880),C=c(66587),D=c(19831),E=c(62352),F=c(46886),G=c(29205),H=c(22297),I=c(98445),J=c(48689),K=c(96176),L=c(41313);class M extends j.Ss{static [e.i]="PgViewBase"}class N{static [e.i]="PgDialect";casing;constructor(a){this.casing=new w(a?.casing)}async migrate(a,b,c){let d="string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e="string"==typeof c?"drizzle":c.migrationsSchema??"drizzle",f=(0,j.ll)`
			CREATE TABLE IF NOT EXISTS ${j.ll.identifier(e)}.${j.ll.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await b.execute((0,j.ll)`CREATE SCHEMA IF NOT EXISTS ${j.ll.identifier(e)}`),await b.execute(f);let g=(await b.all((0,j.ll)`select id, hash, created_at from ${j.ll.identifier(e)}.${j.ll.identifier(d)} order by created_at desc limit 1`))[0];await b.transaction(async b=>{for await(let c of a)if(!g||Number(g.created_at)<c.folderMillis){for(let a of c.sql)await b.execute(j.ll.raw(a));await b.execute((0,j.ll)`insert into ${j.ll.identifier(e)}.${j.ll.identifier(d)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(a){return`"${a}"`}escapeParam(a){return`$${a+1}`}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[(0,j.ll)`with `];for(let[c,d]of a.entries())b.push((0,j.ll)`${j.ll.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push((0,j.ll)`, `);return b.push((0,j.ll)` `),j.ll.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d}){let e=this.buildWithCTE(d),f=c?(0,j.ll)` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,g=b?(0,j.ll)` where ${b}`:void 0;return(0,j.ll)`${e}delete from ${a}${g}${f}`}buildUpdateSet(a,b){let c=a[k.XI.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return j.ll.join(d.flatMap((a,d)=>{let f=c[a],g=b[a]??j.ll.param(f.onUpdateFn(),f),h=(0,j.ll)`${j.ll.identifier(this.casing.getColumnCasing(f))} = ${g}`;return d<e-1?[h,j.ll.raw(", ")]:[h]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,from:f,joins:g}){let h=this.buildWithCTE(e),i=a[H.mu.Symbol.Name],k=a[H.mu.Symbol.Schema],l=a[H.mu.Symbol.OriginalName],m=i===l?void 0:i,n=(0,j.ll)`${k?(0,j.ll)`${j.ll.identifier(k)}.`:void 0}${j.ll.identifier(l)}${m&&(0,j.ll)` ${j.ll.identifier(m)}`}`,o=this.buildUpdateSet(a,b),p=f&&j.ll.join([j.ll.raw(" from "),this.buildFromTable(f)]),q=this.buildJoins(g),r=d?(0,j.ll)` returning ${this.buildSelection(d,{isSingleTable:!f})}`:void 0,s=c?(0,j.ll)` where ${c}`:void 0;return(0,j.ll)`${h}update ${n} set ${o}${p}${q}${s}${r}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let f=[];if((0,e.is)(a,j.Xs.Aliased)&&a.isSelectionField)f.push(j.ll.identifier(a.fieldAlias));else if((0,e.is)(a,j.Xs.Aliased)||(0,e.is)(a,j.Xs)){let c=(0,e.is)(a,j.Xs.Aliased)?a.sql:a;b?f.push(new j.Xs(c.queryChunks.map(a=>(0,e.is)(a,z.Kl)?j.ll.identifier(this.casing.getColumnCasing(a)):a))):f.push(c),(0,e.is)(a,j.Xs.Aliased)&&f.push((0,j.ll)` as ${j.ll.identifier(a.fieldAlias)}`)}else(0,e.is)(a,i.V)&&(b?f.push(j.ll.identifier(this.casing.getColumnCasing(a))):f.push(a));return d<c-1&&f.push((0,j.ll)`, `),f});return j.ll.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];for(let[c,d]of a.entries()){0===c&&b.push((0,j.ll)` `);let f=d.table,g=d.lateral?(0,j.ll)` lateral`:void 0;if((0,e.is)(f,H.mu)){let a=f[H.mu.Symbol.Name],c=f[H.mu.Symbol.Schema],e=f[H.mu.Symbol.OriginalName],h=a===e?void 0:d.alias;b.push((0,j.ll)`${j.ll.raw(d.joinType)} join${g} ${c?(0,j.ll)`${j.ll.identifier(c)}.`:void 0}${j.ll.identifier(e)}${h&&(0,j.ll)` ${j.ll.identifier(h)}`} on ${d.on}`)}else if((0,e.is)(f,j.Ss)){let a=f[l.n].name,c=f[l.n].schema,e=f[l.n].originalName,h=a===e?void 0:d.alias;b.push((0,j.ll)`${j.ll.raw(d.joinType)} join${g} ${c?(0,j.ll)`${j.ll.identifier(c)}.`:void 0}${j.ll.identifier(e)}${h&&(0,j.ll)` ${j.ll.identifier(h)}`} on ${d.on}`)}else b.push((0,j.ll)`${j.ll.raw(d.joinType)} join${g} ${f} on ${d.on}`);c<a.length-1&&b.push((0,j.ll)` `)}return j.ll.join(b)}buildFromTable(a){if((0,e.is)(a,k.XI)&&a[k.XI.Symbol.OriginalName]!==a[k.XI.Symbol.Name]){let b=(0,j.ll)`${j.ll.identifier(a[k.XI.Symbol.OriginalName])}`;return a[k.XI.Symbol.Schema]&&(b=(0,j.ll)`${j.ll.identifier(a[k.XI.Symbol.Schema])}.${b}`),(0,j.ll)`${b} ${j.ll.identifier(a[k.XI.Symbol.Name])}`}return a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:f,table:g,joins:h,orderBy:m,groupBy:n,limit:o,offset:p,lockingClause:q,distinct:r,setOperators:s}){let t,u,v,w=c??(0,L.He)(b);for(let a of w){let b;if((0,e.is)(a.field,i.V)&&(0,k.Io)(a.field.table)!==((0,e.is)(g,K.n)?g._.alias:(0,e.is)(g,M)?g[l.n].name:(0,e.is)(g,j.Xs)?void 0:(0,k.Io)(g))&&(b=a.field.table,!h?.some(({alias:a})=>a===(b[k.XI.Symbol.IsAlias]?(0,k.Io)(b):b[k.XI.Symbol.BaseName])))){let b=(0,k.Io)(a.field.table);throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let x=!h||0===h.length,y=this.buildWithCTE(a);r&&(t=!0===r?(0,j.ll)` distinct`:(0,j.ll)` distinct on (${j.ll.join(r.on,(0,j.ll)`, `)})`);let z=this.buildSelection(w,{isSingleTable:x}),A=this.buildFromTable(g),B=this.buildJoins(h),C=d?(0,j.ll)` where ${d}`:void 0,D=f?(0,j.ll)` having ${f}`:void 0;m&&m.length>0&&(u=(0,j.ll)` order by ${j.ll.join(m,(0,j.ll)`, `)}`),n&&n.length>0&&(v=(0,j.ll)` group by ${j.ll.join(n,(0,j.ll)`, `)}`);let E="object"==typeof o||"number"==typeof o&&o>=0?(0,j.ll)` limit ${o}`:void 0,F=p?(0,j.ll)` offset ${p}`:void 0,G=j.ll.empty();if(q){let a=(0,j.ll)` for ${j.ll.raw(q.strength)}`;q.config.of&&a.append((0,j.ll)` of ${j.ll.join(Array.isArray(q.config.of)?q.config.of:[q.config.of],(0,j.ll)`, `)}`),q.config.noWait?a.append((0,j.ll)` no wait`):q.config.skipLocked&&a.append((0,j.ll)` skip locked`),G.append(a)}let H=(0,j.ll)`${y}select${t} ${z} from ${A}${B}${C}${v}${D}${u}${E}${F}${G}`;return s.length>0?this.buildSetOperations(H,s):H}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:f,orderBy:g,offset:h}}){let i,k=(0,j.ll)`(${a.getSQL()}) `,l=(0,j.ll)`(${d.getSQL()})`;if(g&&g.length>0){let a=[];for(let b of g)if((0,e.is)(b,z.Kl))a.push(j.ll.identifier(b.name));else if((0,e.is)(b,j.Xs)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];(0,e.is)(c,z.Kl)&&(b.queryChunks[a]=j.ll.identifier(c.name))}a.push((0,j.ll)`${b}`)}else a.push((0,j.ll)`${b}`);i=(0,j.ll)` order by ${j.ll.join(a,(0,j.ll)`, `)} `}let m="object"==typeof f||"number"==typeof f&&f>=0?(0,j.ll)` limit ${f}`:void 0,n=j.ll.raw(`${b} ${c?"all ":""}`),o=h?(0,j.ll)` offset ${h}`:void 0;return(0,j.ll)`${k}${n}${l}${i}${m}${o}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:f,select:g,overridingSystemValue_:h}){let i=[],l=Object.entries(a[k.XI.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),m=l.map(([,a])=>j.ll.identifier(this.casing.getColumnCasing(a)));if(g)(0,e.is)(b,j.Xs)?i.push(b):i.push(b.getSQL());else for(let[a,c]of(i.push(j.ll.raw("values ")),b.entries())){let d=[];for(let[a,b]of l){let f=c[a];if(void 0===f||(0,e.is)(f,j.Iw)&&void 0===f.value)if(void 0!==b.defaultFn){let a=b.defaultFn(),c=(0,e.is)(a,j.Xs)?a:j.ll.param(a,b);d.push(c)}else if(b.default||void 0===b.onUpdateFn)d.push((0,j.ll)`default`);else{let a=b.onUpdateFn(),c=(0,e.is)(a,j.Xs)?a:j.ll.param(a,b);d.push(c)}else d.push(f)}i.push(d),a<b.length-1&&i.push((0,j.ll)`, `)}let n=this.buildWithCTE(f),o=j.ll.join(i),p=d?(0,j.ll)` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,q=c?(0,j.ll)` on conflict ${c}`:void 0,r=!0===h?(0,j.ll)`overriding system value `:void 0;return(0,j.ll)`${n}insert into ${a} ${m} ${r}${o}${q}${p}`}buildRefreshMaterializedViewQuery({view:a,concurrently:b,withNoData:c}){let d=b?(0,j.ll)` concurrently`:void 0,e=c?(0,j.ll)` with no data`:void 0;return(0,j.ll)`refresh materialized view${d} ${a}${e}`}prepareTyping(a){if((0,e.is)(a,A.kn)||(0,e.is)(a,B.iX))return"json";if((0,e.is)(a,C.Z5))return"decimal";if((0,e.is)(a,D.Xd))return"time";if((0,e.is)(a,E.KM)||(0,e.is)(a,E.xQ))return"timestamp";if((0,e.is)(a,F.qw)||(0,e.is)(a,F.dw))return"date";else if((0,e.is)(a,G.dL))return"uuid";else return"none"}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:b})}buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:f,queryConfig:g,tableAlias:h,nestedQueryRelation:l,joinOn:m}){let n,o=[],t,u,v=[],w,y=[];if(!0===g)o=Object.entries(f.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:q(b,h),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(f.columns).map(([a,b])=>[a,q(b,h)]));if(g.where){let a="function"==typeof g.where?g.where(d,(0,I.mm)()):g.where;w=a&&s(a,h)}let l=[],m=[];if(g.columns){let a=!1;for(let[b,c]of Object.entries(g.columns))void 0!==c&&b in f.columns&&(a||!0!==c||(a=!0),m.push(b));m.length>0&&(m=a?m.filter(a=>g.columns?.[a]===!0):Object.keys(f.columns).filter(a=>!m.includes(a)))}else m=Object.keys(f.columns);for(let a of m){let b=f.columns[a];l.push({tsKey:a,value:b})}let n=[];if(g.with&&(n=Object.entries(g.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:f.relations[a]}))),g.extras)for(let[a,b]of Object.entries("function"==typeof g.extras?g.extras(d,{sql:j.ll}):g.extras))l.push({tsKey:a,value:r(b,h)});for(let{tsKey:a,value:b}of l)o.push({dbKey:(0,e.is)(b,j.Xs.Aliased)?b.fieldAlias:f.columns[a].name,tsKey:a,field:(0,e.is)(b,i.V)?q(b,h):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let p="function"==typeof g.orderBy?g.orderBy(d,(0,I.rl)()):g.orderBy??[];for(let{tsKey:d,queryConfig:f,relation:l}of(Array.isArray(p)||(p=[p]),v=p.map(a=>(0,e.is)(a,i.V)?q(a,h):s(a,h)),t=g.limit,u=g.offset,n)){let g=(0,I.W0)(b,c,l),i=c[(0,k.Lf)(l.referencedTable)],m=`${h}_${d}`,n=(0,J.Uo)(...g.fields.map((a,b)=>(0,J.eq)(q(g.references[b],m),q(a,h)))),p=this.buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:a[i],tableConfig:b[i],queryConfig:(0,e.is)(l,I.pD)?!0===f?{limit:1}:{...f,limit:1}:f,tableAlias:m,joinOn:n,nestedQueryRelation:l}),r=(0,j.ll)`${j.ll.identifier(m)}.${j.ll.identifier("data")}`.as(d);y.push({on:(0,j.ll)`true`,table:new K.n(p.sql,{},m),alias:m,joinType:"left",lateral:!0}),o.push({dbKey:d,tsKey:d,field:r,relationTableTsKey:i,isJson:!0,selection:p.selection})}}if(0===o.length)throw new x({message:`No fields selected for table "${f.tsName}" ("${h}")`});if(w=(0,J.Uo)(m,w),l){let a=(0,j.ll)`json_build_array(${j.ll.join(o.map(({field:a,tsKey:b,isJson:c})=>c?(0,j.ll)`${j.ll.identifier(`${h}_${b}`)}.${j.ll.identifier("data")}`:(0,e.is)(a,j.Xs.Aliased)?a.sql:a),(0,j.ll)`, `)})`;(0,e.is)(l,I.iv)&&(a=(0,j.ll)`coalesce(json_agg(${a}${v.length>0?(0,j.ll)` order by ${j.ll.join(v,(0,j.ll)`, `)}`:void 0}), '[]'::json)`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:f.tsName,selection:o}];void 0!==t||void 0!==u||v.length>0?(n=this.buildSelectQuery({table:p(d,h),fields:{},fieldsFlat:[{path:[],field:j.ll.raw("*")}],where:w,limit:t,offset:u,orderBy:v,setOperators:[]}),w=void 0,t=void 0,u=void 0,v=[]):n=p(d,h),n=this.buildSelectQuery({table:(0,e.is)(n,H.mu)?n:new K.n(n,{},h),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:(0,e.is)(a,i.V)?q(a,h):a})),joins:y,where:w,limit:t,offset:u,orderBy:v,setOperators:[]})}else n=this.buildSelectQuery({table:p(d,h),fields:{},fieldsFlat:o.map(({field:a})=>({path:[],field:(0,e.is)(a,i.V)?q(a,h):a})),joins:y,where:w,limit:t,offset:u,orderBy:v,setOperators:[]});return{tableTsKey:f.tsName,sql:n,selection:o}}}class O{static [e.i]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===l.n)return{...a[l.n],selectedFields:new Proxy(a[l.n].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=((0,e.is)(a,K.n)?a._.selectedFields:(0,e.is)(a,j.Ss)?a[l.n].selectedFields:a)[b];if((0,e.is)(c,j.Xs.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if((0,e.is)(c,j.Xs)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,e.is)(c,i.V)?this.config.alias?new Proxy(c,new m(new Proxy(c.table,new n(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new O(this.config))}}class P{static [e.i]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class Q{static [e.i]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}var R=c(27017);class S{static [e.i]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,a.withList&&(this.withList=a.withList),this.distinct=a.distinct}authToken;setToken(a){return this.authToken=a,this}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:(0,e.is)(a,K.n)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):(0,e.is)(a,M)?a[l.n].selectedFields:(0,e.is)(a,j.Xs)?{}:(0,L.YD)(a),void 0===this.authToken?new U({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}):new U({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class T extends P{static [e.i]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b},this.tableName=(0,L.zN)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(a){return(b,c)=>{let d=this.tableName,f=(0,L.zN)(b);if("string"==typeof f&&this.config.joins?.some(a=>a.alias===f))throw Error(`Alias "${f}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof d&&(this.config.fields={[d]:this.config.fields}),"string"==typeof f&&!(0,e.is)(b,j.Xs))){let a=(0,e.is)(b,K.n)?b._.selectedFields:(0,e.is)(b,j.Ss)?b[l.n].selectedFields:b[k.XI.Symbol.Columns];this.config.fields[f]=a}if("function"==typeof c&&(c=c(new Proxy(this.config.fields,new O({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:c,table:b,joinType:a,alias:f}),"string"==typeof f)switch(a){case"left":this.joinsNotNullableMap[f]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!0;break;case"inner":this.joinsNotNullableMap[f]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(a,b){return c=>{let d="function"==typeof c?c(W()):c;if(!(0,L.DV)(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new O({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new O({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new O({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new O({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}for(a,b={}){return this.config.lockingClause={strength:a,config:b},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){return new Proxy(new K.n(this.getSQL(),this.config.fields,a),new O({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new O({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class U extends T{static [e.i]="PgSelect";_prepare(a){let{session:b,config:c,dialect:d,joinsNotNullableMap:e,authToken:f}=this;if(!b)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");return R.k.startActiveSpan("drizzle.prepareQuery",()=>{let g=(0,L.He)(c.fields),h=b.prepareQuery(d.sqlToQuery(this.getSQL()),g,a,!0);return h.joinsNotNullableMap=e,void 0===f?h:h.setToken(f)})}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>R.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}function V(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!(0,L.DV)(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}(0,L.XJ)(U,[Q]);let W=()=>({union:X,unionAll:Y,intersect:Z,intersectAll:$,except:_,exceptAll:aa}),X=V("union",!1),Y=V("union",!0),Z=V("intersect",!1),$=V("intersect",!0),_=V("except",!1),aa=V("except",!0);class ab{static [e.i]="PgQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=(0,e.is)(a,N)?a:void 0,this.dialectConfig=(0,e.is)(a,N)?void 0:a}$with(a){let b=this;return{as:c=>("function"==typeof c&&(c=c(b)),new Proxy(new K.J(c.getSQL(),c.getSelectedFields(),a,!0),new O({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...a){let b=this;return{select:function(c){return new S({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(a){return new S({fields:a??void 0,session:void 0,dialect:b.getDialect(),distinct:!0})},selectDistinctOn:function(a,c){return new S({fields:c??void 0,session:void 0,dialect:b.getDialect(),distinct:{on:a}})}}}select(a){return new S({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new S({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(a,b){return new S({fields:b??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:a}})}getDialect(){return this.dialect||(this.dialect=new N(this.dialectConfig)),this.dialect}}class ac{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [e.i]="PgUpdateBuilder";authToken;setToken(a){return this.authToken=a,this}set(a){return void 0===this.authToken?new ad(this.table,(0,L.q)(this.table,a),this.session,this.dialect,this.withList):new ad(this.table,(0,L.q)(this.table,a),this.session,this.dialect,this.withList).setToken(this.authToken)}}class ad extends Q{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]},this.tableName=(0,L.zN)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [e.i]="PgUpdate";config;tableName;joinsNotNullableMap;from(a){let b=(0,L.zN)(a);return"string"==typeof b&&(this.joinsNotNullableMap[b]=!0),this.config.from=a,this}getTableLikeFields(a){return(0,e.is)(a,H.mu)?a[k.XI.Symbol.Columns]:(0,e.is)(a,K.n)?a._.selectedFields:a[l.n].selectedFields}createJoin(a){return(b,c)=>{let d=(0,L.zN)(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from&&!(0,e.is)(this.config.from,j.Xs)?this.getTableLikeFields(this.config.from):void 0;c=c(new Proxy(this.config.table[k.XI.Symbol.Columns],new O({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new O({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:c,table:b,joinType:a,alias:d}),"string"==typeof d)switch(a){case"left":this.joinsNotNullableMap[d]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!0;break;case"inner":this.joinsNotNullableMap[d]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}returning(a){if(!a&&(a=Object.assign({},this.config.table[k.XI.Symbol.Columns]),this.config.from)){let b=(0,L.zN)(this.config.from);if("string"==typeof b&&this.config.from&&!(0,e.is)(this.config.from,j.Xs)){let c=this.getTableLikeFields(this.config.from);a[b]=c}for(let b of this.config.joins){let c=(0,L.zN)(b.table);if("string"==typeof c&&!(0,e.is)(b.table,j.Xs)){let d=this.getTableLikeFields(b.table);a[c]=d}}}return this.config.returning=(0,L.He)(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){let b=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0);return b.joinsNotNullableMap=this.joinsNotNullableMap,b}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>this._prepare().execute(a,this.authToken);$dynamic(){return this}}class ae{constructor(a,b,c,d,e){this.table=a,this.session=b,this.dialect=c,this.withList=d,this.overridingSystemValue_=e}static [e.i]="PgInsertBuilder";authToken;setToken(a){return this.authToken=a,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[k.XI.Symbol.Columns];for(let d of Object.keys(a)){let f=a[d];b[d]=(0,e.is)(f,j.Xs)?f:new j.Iw(f,c[d])}return b});return void 0===this.authToken?new af(this.table,b,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_):new af(this.table,b,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(a){let b="function"==typeof a?a(new ab):a;if(!(0,e.is)(b,j.Xs)&&!(0,L.DV)(this.table[k.e],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new af(this.table,b,this.session,this.dialect,this.withList,!0)}}class af extends Q{constructor(a,b,c,d,e,f,g){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f,overridingSystemValue_:g}}static [e.i]="PgInsert";config;returning(a=this.config.table[k.XI.Symbol.Columns]){return this.config.returning=(0,L.He)(a),this}onConflictDoNothing(a={}){if(void 0===a.target)this.config.onConflict=(0,j.ll)`do nothing`;else{let b="";b=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target));let c=a.where?(0,j.ll)` where ${a.where}`:void 0;this.config.onConflict=(0,j.ll)`(${j.ll.raw(b)})${c} do nothing`}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let b=a.where?(0,j.ll)` where ${a.where}`:void 0,c=a.targetWhere?(0,j.ll)` where ${a.targetWhere}`:void 0,d=a.setWhere?(0,j.ll)` where ${a.setWhere}`:void 0,e=this.dialect.buildUpdateSet(this.config.table,(0,L.q)(this.config.table,a.set)),f="";return f=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target)),this.config.onConflict=(0,j.ll)`(${j.ll.raw(f)})${c} do update set ${e}${b}${d}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return R.k.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>R.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken));$dynamic(){return this}}class ag extends Q{constructor(a,b,c,d){super(),this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [e.i]="PgDelete";config;where(a){return this.config.where=a,this}returning(a=this.config.table[k.XI.Symbol.Columns]){return this.config.returning=(0,L.He)(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return R.k.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>R.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken));$dynamic(){return this}}class ah extends j.Xs{constructor(a){super(ah.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.mapWith(Number),this.session=a.session,this.sql=ah.buildCount(a.source,a.filters)}sql;token;static [e.i]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(a,b){return(0,j.ll)`(select count(*) from ${a}${j.ll.raw(" where ").if(b)}${b})`}static buildCount(a,b){return(0,j.ll)`select count(*) as count from ${a}${j.ll.raw(" where ").if(b)}${b};`}setToken(a){this.token=a}then(a,b){return Promise.resolve(this.session.count(this.sql,this.token)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class ai{constructor(a,b,c,d,e,f,g){this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g}static [e.i]="PgRelationalQueryBuilder";findMany(a){return new aj(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return new aj(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class aj extends Q{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [e.i]="PgRelationalQuery";_prepare(a){return R.k.startActiveSpan("drizzle.prepareQuery",()=>{let{query:b,builtQuery:c}=this._toSQL();return this.session.prepareQuery(c,void 0,a,!0,(a,c)=>{let d=a.map(a=>(0,I.I$)(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})})}prepare(a){return this._prepare(a)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let a=this._getQuery(),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(a){return this.authToken=a,this}execute(){return R.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class ak extends Q{constructor(a,b,c,d){super(),this.execute=a,this.sql=b,this.query=c,this.mapBatchResult=d}static [e.i]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class al extends Q{constructor(a,b,c){super(),this.session=b,this.dialect=c,this.config={view:a}}static [e.i]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return R.k.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>R.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}class am{constructor(a,b,c){if(this.dialect=a,this.session=b,this._=c?{schema:c.schema,fullSchema:c.fullSchema,tableNamesMap:c.tableNamesMap,session:b}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:b},this.query={},this._.schema)for(let[d,e]of Object.entries(this._.schema))this.query[d]=new ai(c.fullSchema,this._.schema,this._.tableNamesMap,c.fullSchema[d],e,a,b)}static [e.i]="PgDatabase";query;$with(a){let b=this;return{as:c=>("function"==typeof c&&(c=c(new ab(b.dialect))),new Proxy(new K.J(c.getSQL(),c.getSelectedFields(),a,!0),new O({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}$count(a,b){return new ah({source:a,filters:b,session:this.session})}with(...a){let b=this;return{select:function(c){return new S({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new S({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},selectDistinctOn:function(c,d){return new S({fields:d??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:{on:c}})},update:function(c){return new ac(c,b.session,b.dialect,a)},insert:function(c){return new ae(c,b.session,b.dialect,a)},delete:function(c){return new ag(c,b.session,b.dialect,a)}}}select(a){return new S({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new S({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(a,b){return new S({fields:b??void 0,session:this.session,dialect:this.dialect,distinct:{on:a}})}update(a){return new ac(a,this.session,this.dialect)}insert(a){return new ae(a,this.session,this.dialect)}delete(a){return new ag(a,this.session,this.dialect)}refreshMaterializedView(a){return new al(a,this.session,this.dialect)}authToken;execute(a){let b="string"==typeof a?j.ll.raw(a):a.getSQL(),c=this.dialect.sqlToQuery(b),d=this.session.prepareQuery(c,void 0,void 0,!1);return new ak(()=>d.execute(void 0,this.authToken),b,c,a=>d.mapResult(a,!0))}transaction(a,b){return this.session.transaction(a,b)}}class an{constructor(a){this.query=a}authToken;getQuery(){return this.query}mapResult(a,b){return a}setToken(a){return this.authToken=a,this}static [e.i]="PgPreparedQuery";joinsNotNullableMap}class ao{constructor(a){this.dialect=a}static [e.i]="PgSession";execute(a,b){return R.k.startActiveSpan("drizzle.operation",()=>R.k.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1)).setToken(b).execute(void 0,b))}all(a){return this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1).all()}async count(a,b){return Number((await this.execute(a,b))[0].count)}}class ap extends am{constructor(a,b,c,d=0){super(a,b,c),this.schema=c,this.nestedIndex=d}static [e.i]="PgTransaction";rollback(){throw new y}getTransactionConfigSQL(a){let b=[];return a.isolationLevel&&b.push(`isolation level ${a.isolationLevel}`),a.accessMode&&b.push(a.accessMode),"boolean"==typeof a.deferrable&&b.push(a.deferrable?"deferrable":"not deferrable"),j.ll.raw(b.join(" "))}setTransaction(a){return this.session.execute((0,j.ll)`set transaction ${this.getTransactionConfigSQL(a)}`)}}class aq extends an{constructor(a,b,c,d,e,f,g){super({sql:b,params:c}),this.client=a,this.queryString=b,this.params=c,this.logger=d,this.fields=e,this._isResponseInArrayMode=f,this.customResultMapper=g}static [e.i]="PostgresJsPreparedQuery";async execute(a={}){return R.k.startActiveSpan("drizzle.execute",async b=>{let c=(0,j.Ct)(this.params,a);b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.logger.logQuery(this.queryString,c);let{fields:d,queryString:e,client:f,joinsNotNullableMap:g,customResultMapper:h}=this;if(!d&&!h)return R.k.startActiveSpan("drizzle.driver.execute",()=>f.unsafe(e,c));let i=await R.k.startActiveSpan("drizzle.driver.execute",()=>(b?.setAttributes({"drizzle.query.text":e,"drizzle.query.params":JSON.stringify(c)}),f.unsafe(e,c).values()));return R.k.startActiveSpan("drizzle.mapResponse",()=>h?h(i):i.map(a=>(0,L.a6)(d,a,g)))})}all(a={}){return R.k.startActiveSpan("drizzle.execute",async b=>{let c=(0,j.Ct)(this.params,a);return b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.logger.logQuery(this.queryString,c),R.k.startActiveSpan("drizzle.driver.execute",()=>(b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.client.unsafe(this.queryString,c)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class ar extends ao{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new h}static [e.i]="PostgresJsSession";logger;prepareQuery(a,b,c,d,e){return new aq(this.client,a.sql,a.params,this.logger,b,d,e)}query(a,b){return this.logger.logQuery(a,b),this.client.unsafe(a,b).values()}queryObjects(a,b){return this.client.unsafe(a,b)}transaction(a,b){return this.client.begin(async c=>{let d=new ar(c,this.dialect,this.schema,this.options),e=new as(this.dialect,d,this.schema);return b&&await e.setTransaction(b),a(e)})}}class as extends ap{constructor(a,b,c,d=0){super(a,b,c,d),this.session=b}static [e.i]="PostgresJsTransaction";transaction(a){return this.session.client.savepoint(b=>{let c=new ar(b,this.dialect,this.schema,this.session.options);return a(new as(this.dialect,c,this.schema))})}}class at extends am{static [e.i]="PostgresJsDatabase"}function au(a,b={}){let c,d,e=a=>a;for(let b of["1184","1082","1083","1114"])a.options.parsers[b]=e,a.options.serializers[b]=e;a.options.serializers["114"]=e,a.options.serializers["3802"]=e;let f=new N({casing:b.casing});if(!0===b.logger?c=new g:!1!==b.logger&&(c=b.logger),b.schema){let a=(0,I._k)(b.schema,I.DZ);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let h=new ar(a,f,d,{logger:c}),i=new at(f,h,d);return i.$client=a,i}function av(...a){if("string"==typeof a[0])return au((0,d.A)(a[0]),a[1]);if((0,L.Lq)(a[0])){let{connection:b,client:c,...e}=a[0];if(c)return au(c,e);if("object"==typeof b&&void 0!==b.url){let{url:a,...c}=b;return au((0,d.A)(a,c),e)}return au((0,d.A)(b),e)}return au(a[0],a[1])}(av||(av={})).mock=function(a){return au({},a)}},62352:(a,b,c)=>{c.d(b,{KM:()=>i,vE:()=>l,xQ:()=>k});var d=c(46493),e=c(41313),f=c(59048),g=c(91983);class h extends g.u{static [d.i]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new i(a,this.config)}}class i extends f.Kl{static [d.i]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=a=>new Date(this.withTimezone?a:a+"+0000");mapToDriverValue=a=>a.toISOString()}class j extends g.u{static [d.i]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new k(a,this.config)}}class k extends f.Kl{static [d.i]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}}function l(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return d?.mode==="string"?new j(c,d.withTimezone??!1,d.precision):new h(c,d?.withTimezone??!1,d?.precision)}},66587:(a,b,c)=>{c.d(b,{Z5:()=>h,_:()=>j,sH:()=>i});var d=c(46493),e=c(41313),f=c(59048);class g extends f.pe{static [d.i]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function i(a,b){let{name:c,config:d}=(0,e.Ll)(a,b);return new g(c,d?.precision,d?.scale)}let j=i},71559:(a,b,c)=>{c.d(b,{Y:()=>e,i:()=>f});var d=c(50047);function e(a){return(0,d.ll)`${a} asc`}function f(a){return(0,d.ll)`${a} desc`}},75947:(a,b,c)=>{c.d(b,{BU:()=>g,rL:()=>j});var d=c(46493),e=c(59048);let f=Symbol.for("drizzle:isPgEnum");function g(a){return!!a&&"function"==typeof a&&f in a&&!0===a[f]}class h extends e.pe{static [d.i]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new i(a,this.config)}}class i extends e.Kl{static [d.i]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}function j(a,b){var c=a,d=b,e=void 0;let g=Object.assign(a=>new h(a??"",g),{enumName:c,enumValues:d,schema:e,[f]:!0});return g}},80228:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(46493);class e{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [d.i]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}},84266:(a,b,c)=>{c.d(b,{nd:()=>i});var d=c(46493),e=c(59048),f=c(6766);class g extends f.p{static [d.i]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new h(a,this.config)}}class h extends e.Kl{static [d.i]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}function i(a){return new g(a??"")}},91983:(a,b,c)=>{c.d(b,{u:()=>g});var d=c(46493),e=c(50047),f=c(59048);class g extends f.pe{static [d.i]="PgDateColumnBaseBuilder";defaultNow(){return this.default((0,e.ll)`now()`)}}},94728:(a,b,c)=>{c.d(b,{Fx:()=>h,kn:()=>g});var d=c(46493),e=c(59048);class f extends e.pe{static [d.i]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new g(a,this.config)}}class g extends e.Kl{static [d.i]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function h(a){return new f(a??"")}},96176:(a,b,c)=>{c.d(b,{J:()=>f,n:()=>e});var d=c(46493);class e{static [d.i]="Subquery";constructor(a,b,c,d=!1){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d}}}class f extends e{static [d.i]="WithSubquery"}},98445:(a,b,c)=>{c.d(b,{iv:()=>p,pD:()=>o,DZ:()=>v,_k:()=>s,mm:()=>q,rl:()=>r,I$:()=>function a(b,c,d,g,h=a=>a){let i={};for(let[j,k]of g.entries())if(k.isJson){let e=c.relations[k.tsKey],g=d[j],l="string"==typeof g?JSON.parse(g):g;i[k.tsKey]=(0,f.is)(e,o)?l&&a(b,b[k.relationTableTsKey],l,k.selection,h):l.map(c=>a(b,b[k.relationTableTsKey],c,k.selection,h))}else{let a,b=h(d[j]),c=k.field;a=(0,f.is)(c,e.V)?c:(0,f.is)(c,l.Xs)?c.decoder:c.sql.decoder,i[k.tsKey]=null===b?null:a.mapFromDriverValue(b)}return i},W0:()=>u,K1:()=>t});var d=c(7284),e=c(80228),f=c(46493),g=c(22297);class h{static [f.i]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new i(a,this.columns,this.name)}}class i{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [f.i]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[g.mu.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}var j=c(48689),k=c(71559),l=c(50047);class m{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[d.XI.Symbol.Name]}static [f.i]="Relation";referencedTableName;fieldName}class n{constructor(a,b){this.table=a,this.config=b}static [f.i]="Relations"}class o extends m{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [f.i]="One";withFieldName(a){let b=new o(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class p extends m{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [f.i]="Many";withFieldName(a){let b=new p(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function q(){return{and:j.Uo,between:j.Tq,eq:j.eq,exists:j.t2,gt:j.gt,gte:j.RO,ilike:j.B3,inArray:j.RV,isNull:j.kZ,isNotNull:j.Pe,like:j.mj,lt:j.lt,lte:j.wJ,ne:j.ne,not:j.AU,notBetween:j.o8,notExists:j.KJ,notLike:j.RK,notIlike:j.q1,notInArray:j.KL,or:j.or,sql:l.ll}}function r(){return{sql:l.ll,asc:k.Y,desc:k.i}}function s(a,b){1===Object.keys(a).length&&"default"in a&&!(0,f.is)(a.default,d.XI)&&(a=a.default);let c={},e={},g={};for(let[i,j]of Object.entries(a))if((0,f.is)(j,d.XI)){let a=(0,d.Lf)(j),b=e[a];for(let e of(c[a]=i,g[i]={tsName:i,dbName:j[d.XI.Symbol.Name],schema:j[d.XI.Symbol.Schema],columns:j[d.XI.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(j[d.XI.Symbol.Columns])))e.primary&&g[i].primaryKey.push(e);let k=j[d.XI.Symbol.ExtraConfigBuilder]?.(j[d.XI.Symbol.ExtraConfigColumns]);if(k)for(let a of Object.values(k))(0,f.is)(a,h)&&g[i].primaryKey.push(...a.columns)}else if((0,f.is)(j,n)){let a,f=(0,d.Lf)(j.table),h=c[f];for(let[c,d]of Object.entries(j.config(b(j.table))))if(h){let b=g[h];b.relations[c]=d,a&&b.primaryKey.push(...a)}else f in e||(e[f]={relations:{},primaryKey:a}),e[f].relations[c]=d}return{tables:g,tableNamesMap:c}}function t(a,b){return new n(a,a=>Object.fromEntries(Object.entries(b(a)).map(([a,b])=>[a,b.withFieldName(a)])))}function u(a,b,c){if((0,f.is)(c,o)&&c.config)return{fields:c.config.fields,references:c.config.references};let e=b[(0,d.Lf)(c.referencedTable)];if(!e)throw Error(`Table "${c.referencedTable[d.XI.Symbol.Name]}" not found in schema`);let g=a[e];if(!g)throw Error(`Table "${e}" not found in schema`);let h=c.sourceTable,i=b[(0,d.Lf)(h)];if(!i)throw Error(`Table "${h[d.XI.Symbol.Name]}" not found in schema`);let j=[];for(let a of Object.values(g.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&j.push(a);if(j.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${e}"`):Error(`There are multiple relations between "${e}" and "${c.sourceTable[d.XI.Symbol.Name]}". Please specify relation name`);if(j[0]&&(0,f.is)(j[0],o)&&j[0].config)return{fields:j[0].config.references,references:j[0].config.fields};throw Error(`There is not enough information to infer relation "${i}.${c.fieldName}"`)}function v(a){return{one:function(b,c){return new o(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new p(a,b,c)}}}}};