(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{2599:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(5155),n=r(2115),l=r(63);function c(e){var t;let{project:r}=e;return(0,s.jsx)("div",{className:"   grid pl-3 text-base font-semibold   ",style:{height:"".concat(50,"px")},children:null!=(t=null==r?void 0:r.certificationName)?t:"資格名（モック）"})}function a(){return(0,s.jsx)("div",{className:"   grid text-xs font-semibold   ",style:{height:"".concat(50,"px")},children:(0,s.jsx)("div",{className:"flex items-center"})})}function o(e){let{step:t,isOpen:r,toggle:l}=e,c=t.stepId,[a,o]=(0,n.useState)(!1);return(0,s.jsxs)("div",{className:"relative",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[(0,s.jsx)("div",{className:"   grid cursor-pointer font-normal   ",style:{height:"".concat(50,"px")},onClick:()=>l(c),children:(0,s.jsxs)("div",{className:"grid grid-cols-[1fr_4fr] font-bold",children:[(0,s.jsx)("span",{className:"flex items-center justify-center",children:r?"▼":"▶"}),(0,s.jsx)("span",{className:"flex items-center text-left",children:t.title})]})}),a&&t.theme&&(0,s.jsx)("div",{className:"absolute left-full ml-2 top-0 bg-white border border-gray-300 p-3 text-xs z-50 rounded shadow-lg max-w-xs break-words whitespace-pre-wrap w-2xl",children:t.theme})]})}function i(e){let{task:t}=e,[r,l]=(0,n.useState)(!1);return(0,s.jsxs)("div",{className:"relative",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[(0,s.jsx)("div",{className:"   grid cursor-pointer   ",style:{height:"".concat(50,"px")},children:(0,s.jsx)("div",{className:"flex items-center text-left pl-6 text-xs",children:t.title})}),r&&t.description&&(0,s.jsx)("div",{className:"absolute left-full ml-2 top-0 bg-white border border-gray-300 p-3 text-xs z-50 rounded shadow-lg max-w-xs break-words whitespace-pre-wrap w-2xl",children:t.description})]})}function u(e){let{steps:t,openSteps:r,toggle:n}=e,l=t.flatMap(e=>r[e.stepId]?[e,...e.tasks]:[e]);return(0,s.jsxs)("div",{children:[(0,s.jsx)(a,{}),l.map(e=>{var t;return"tasks"in e?(0,s.jsx)(o,{step:e,isOpen:null!=(t=r[e.stepId])&&t,toggle:n},e.stepId):(0,s.jsx)(i,{task:e},e.taskId)})]})}function d(e){let{project:t,steps:r,toggleStep:l,openSteps:a,syncScroll:o}=e,i=(0,n.useRef)(null);return(0,s.jsxs)("div",{ref:i,onScroll:()=>{i.current&&o&&o(i.current.scrollTop)},className:"   bg-gray-100 text-xs   w-[240px] pl-2 pr-2",children:[(0,s.jsx)(c,{project:t}),(0,s.jsx)(u,{steps:r,openSteps:a,toggle:l})]})}var h=r(7205),p=r(6197),x=r(5041);let f=e=>{if(!e)return null;let t="string"==typeof e?new Date(e):e;return new Date(t.getFullYear(),t.getMonth(),t.getDate())},m=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();function g(e){let{steps:t=[],openSteps:r={},syncScroll:l}=e,{start:c,end:a}=(0,n.useMemo)(()=>{let e=f(new Date),t=new Date(e);t.setMonth(t.getMonth()-1);let r=new Date(e);return r.setMonth(r.getMonth()+3),{start:t,end:r}},[]),o=(0,n.useMemo)(()=>(0,h.k)({start:c,end:a}),[c,a]),i=50*o.length,u=t.flatMap(e=>r[e.stepId]?[e,...e.tasks]:[e]),d=(0,n.useRef)(null),g=(0,n.useRef)(!1),j=(0,n.useRef)(0),v=(0,n.useRef)(0),b=(0,n.useRef)(0),w=(0,n.useRef)(0),y=()=>{g.current=!1};return(0,s.jsx)("div",{ref:d,onScroll:()=>{d.current&&l&&l(d.current.scrollTop)},onMouseDown:e=>{d.current&&(g.current=!0,j.current=e.clientX,v.current=e.clientY,b.current=d.current.scrollLeft,w.current=d.current.scrollTop)},onMouseMove:e=>{if(!g.current||!d.current)return;let t=e.clientX-j.current,r=e.clientY-v.current;d.current.scrollLeft=b.current-t,d.current.scrollTop=w.current-r},onMouseUp:y,onMouseLeave:y,onTouchStart:e=>{d.current&&(g.current=!0,j.current=e.touches[0].clientX,v.current=e.touches[0].clientY,b.current=d.current.scrollLeft,w.current=d.current.scrollTop)},onTouchMove:e=>{if(!g.current||!d.current)return;let t=e.touches[0].clientX-j.current,r=e.touches[0].clientY-v.current;d.current.scrollLeft=b.current-t,d.current.scrollTop=w.current-r},onTouchEnd:()=>{g.current=!1},className:"cursor-grab select-none",style:{height:"100%"},children:(0,s.jsxs)("div",{className:"relative",style:{height:"100%"},children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 flex",style:{height:"100%"},children:o.map((e,t)=>(0,s.jsx)("div",{style:{width:50,height:"100%",backgroundColor:t%2==0?"#E6E6EF":"#FFFFFF"}},t))}),(0,s.jsxs)("table",{className:"relative z-10",style:{width:i,tableLayout:"fixed",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:" sticky left-0 top-0 z-10",children:o.map(e=>(0,s.jsxs)("th",{style:{width:50,padding:0,position:"sticky",top:0,zIndex:20,backgroundColor:"#FFFFFF"},children:[(0,s.jsx)("div",{style:{width:"100%",height:"".concat(50,"px"),backgroundColor:"#FFFFFF",maxWidth:"1800px",margin:"0 auto"}}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center w-full text-xs",style:{height:"".concat(50,"px"),borderTop:"1px solid #000",borderBottom:"1px solid #000"},children:[(0,s.jsx)("span",{children:(0,p.GP)(e,"M/d")}),(0,s.jsxs)("span",{children:["(",(0,p.GP)(e,"EEE",{locale:x.ja}),")"]})]})]},e.toISOString()))})}),(0,s.jsx)("tbody",{children:u.map(e=>{var t,r,n,l;if("tasks"in e){let n=f(null!=(t=e.startDate)?t:new Date),l=f(null!=(r=e.endDate)?r:new Date),c=m(n),a=m(l);return(0,s.jsx)("tr",{style:{height:"".concat(50,"px")},children:o.map(e=>{let t=m(e),r=t===c,n=t===a;return(0,s.jsx)("td",{style:{padding:0},children:t>=c&&t<=a&&(0,s.jsx)("div",{className:"bg-purple-500 h-6",style:{borderTopLeftRadius:8*!!r,borderBottomLeftRadius:8*!!r,borderTopRightRadius:8*!!n,borderBottomRightRadius:8*!!n}})},e.toISOString())})},e.stepId)}{let t=f(null!=(n=e.startDate)?n:new Date),r=f(null!=(l=e.endDate)?l:new Date),c=m(t),a=m(r);return(0,s.jsx)("tr",{style:{height:"".concat(50,"px")},children:o.map(e=>{let t=m(e),r=t===c,n=t===a;return(0,s.jsx)("td",{style:{padding:0},children:t>=c&&t<=a&&(0,s.jsx)("div",{className:"bg-blue-400 h-6",style:{borderTopLeftRadius:8*!!r,borderBottomLeftRadius:8*!!r,borderTopRightRadius:8*!!n,borderBottomRightRadius:8*!!n}})},e.toISOString())})},e.taskId)}})})]})]})})}var j=r(6896),v=r.n(j);function b(){let e=(0,l.useParams)().id,[t,r]=(0,n.useState)(null),[c,a]=(0,n.useState)([]),[o,i]=(0,n.useState)({}),u=(0,n.useRef)(null),h=(0,n.useRef)(null);(0,n.useEffect)(()=>{e&&(fetch("/api/projects/".concat(e)).then(e=>e.json()).then(e=>r(e)).catch(e=>console.error("プロジェクト取得エラー:",e)),fetch("/api/projects/".concat(e,"/steps")).then(e=>e.json()).then(async e=>{a(await Promise.all(e.map(async e=>{try{let t=await fetch("/api/steps/".concat(e.stepId,"/tasks")),r=await t.json();return{...e,tasks:r}}catch(t){return console.error("タスク取得エラー (stepId=".concat(e.stepId,"):"),t),{...e,tasks:[]}}})))}).catch(e=>console.error("ステップ取得エラー:",e)))},[e]);let p=(e,t)=>{"sidebar"===e&&h.current&&(h.current.scrollTop=t),"gantt"===e&&u.current&&(u.current.scrollTop=t)};return(0,s.jsxs)("div",{className:"".concat(v().className," text-stone-950 flex"),children:[(0,s.jsx)("div",{ref:u,className:"bg-gray-100",children:(0,s.jsx)("div",{className:"".concat(v().className," text-stone-950"),children:(0,s.jsx)(d,{project:t,steps:c,toggleStep:e=>{i(t=>({...t,[e]:!t[e]}))},openSteps:o,syncScroll:e=>p("sidebar",e)})})}),(0,s.jsx)("div",{ref:h,className:"overflow-y-auto flex-1 min-h-dvh",children:(0,s.jsx)("div",{className:"".concat(v().className," text-stone-950 h-full"),children:(0,s.jsx)(g,{steps:c,openSteps:o,syncScroll:e=>p("gantt",e)})})})]})}},7776:(e,t,r)=>{Promise.resolve().then(r.bind(r,2599))}},e=>{e.O(0,[340,345,441,493,358],()=>e(e.s=7776)),_N_E=e.O()}]);